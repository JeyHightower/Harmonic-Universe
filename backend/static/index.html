<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Initialize flags to prevent multiple script execution -->
    <script>
      // Simple flag to prevent duplicate execution
      window.__UTILS_FIX_APPLIED__ = false;
      window.__COMPLETE_FIX_APPLIED__ = false;
    </script>

    <!-- Add debug script -->
    <script src="/debug.js"></script>

    <!-- Simple version patch with no recursion risk -->
    <script src="/version-patch.js"></script>

    <!-- IMPORTANT: Remove or comment out previous fix scripts -->
    <!-- <script src="/complete-fix.js"></script> -->
    <!-- <script src="/ant-icons-patch.js"></script> -->
    <!-- <script src="/utils-fix.js"></script> -->
    <!-- <script src="/ant-design-polyfill.js"></script> -->
    <!-- <script src="/react-polyfill.js"></script> -->
    <!-- <script src="/react-context-provider.js"></script> -->

    <!-- Add global error handler for script loading -->
    <script>
      // Create a global error handler for script loading
      window.addEventListener(
        "error",
        function (e) {
          if (e.target && e.target.src && e.target.src.includes("ant-icons")) {
            console.warn("Error loading ant-icons, creating fallback");

            // Create mock IconContext if React exists
            if (window.React && window.React.createContext) {
              window.IconContext = window.React.createContext({});
            } else {
              // Basic fallback if React isn't available
              window.IconContext = {
                Provider: function (props) {
                  return props.children;
                },
                Consumer: function (props) {
                  return props.children({});
                },
              };
            }

            // Prevent error from showing in console
            e.preventDefault();
          }
        },
        true
      );
    </script>

    <!-- Ant Design Icons with fallback -->
    <script>
      window.antIconsLoaded = false;
    </script>
    <script
      src="/ant-icons.js"
      onerror="console.error('Failed to load Ant Icons, using fallback'); document.write('<script src=\'/ant-icons-fallback.js\'><\/script>')"
    ></script>
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Harmonic Universe</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script type="module" crossorigin src="./assets/index-Cqme2zdk.js"></script>
    <link rel="modulepreload" crossorigin href="./assets/vendor-C7BCHqNS.js" />
    <link
      rel="modulepreload"
      crossorigin
      href="./assets/ant-design-BPZweP9f.js"
    />
    <link
      rel="modulepreload"
      crossorigin
      href="./assets/ant-icons-BVj3fsgN.js"
    />
    <link rel="stylesheet" crossorigin href="./assets/index-YhiCDp85.css" />

    <script>
      // Ant Design Icons fallback handler
      window.__ANT_ICONS_VERSION__ = "5.6.1";
      window.__ANT_ICONS_FALLBACK_HANDLER__ = function () {
        console.log("Running Ant Icons fallback handler");

        // Create basic icon component factory
        function createIconComponent(name) {
          return function (props) {
            return {
              $typeof: Symbol.for("react.element"),
              type: "span",
              props: {
                className:
                  "anticon anticon-" +
                  name +
                  (props && props.className ? " " + props.className : ""),
                style: props && props.style ? props.style : {},
                children: [],
              },
            };
          };
        }

        // Create basic icons
        window.AntDesignIcons = {
          // Common icons
          CloseOutlined: createIconComponent("close"),
          CheckOutlined: createIconComponent("check"),
          LoadingOutlined: createIconComponent("loading"),
          DownOutlined: createIconComponent("down"),
          UpOutlined: createIconComponent("up"),
          LeftOutlined: createIconComponent("left"),
          RightOutlined: createIconComponent("right"),

          // API functions
          createFromIconfontCN: function () {
            return function () {
              return null;
            };
          },
          getTwoToneColor: function () {
            return "#1890ff";
          },
          setTwoToneColor: function () {},
        };
      };

      // Set timeout to check if icons loaded correctly
      setTimeout(function () {
        if (!window.AntDesignIcons) {
          console.warn(
            "Ant Design Icons not loaded correctly, applying fallback"
          );
          window.__ANT_ICONS_FALLBACK_HANDLER__();
        }
      }, 1000);
    </script>

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f7f9fc;
      }
      #root {
        min-height: 100vh;
      }
      #debug-panel {
        position: fixed;
        bottom: 0;
        right: 0;
        background-color: rgba(255, 255, 255, 0.9);
        border: 1px solid #ddd;
        border-radius: 4px 0 0 0;
        padding: 10px;
        font-family: monospace;
        font-size: 12px;
        max-width: 300px;
        max-height: 200px;
        overflow: auto;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        flex-direction: column;
      }
      .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border-left-color: #09f;
        animation: spin 1s linear infinite;
        margin-bottom: 16px;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <!-- React Fix Loader - ensures proper module loading -->
    <script src="/static/react-fixes/react-fix-loader.js"></script>

    <div id="root">
      <!-- Loading state before React renders -->
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading Harmonic Universe...</p>
      </div>
    </div>

    <header>
      <h1>Harmonic Universe</h1>
      <p>Interactive Music Experience</p>
    </header>

    <main>
      <h2>Welcome!</h2>
      <p>
        The Harmonic Universe application is designed to provide a unique
        interactive musical experience where you can create, share, and explore
        music in new ways.
      </p>

      <p>
        This is a static fallback page that indicates your application's backend
        is running, but the full frontend experience may not be available at the
        moment.
      </p>

      <div class="status-box">
        <h3>Application Status</h3>
        <p id="status-message">
          <span class="status-indicator status-loading"></span>
          Checking API connection...
        </p>
        <p id="environment-info">Environment: Production</p>
        <p id="deployment-info">Created on: <span id="creation-date"></span></p>
      </div>
    </main>

    <footer>
      <p>Harmonic Universe &copy; 2023 - A Musical Experience</p>
    </footer>

    <script>
      // Set the creation date
      document.getElementById("creation-date").textContent =
        new Date().toLocaleString();

      // Check API status
      fetch("/api/health")
        .then((response) => response.json())
        .then((data) => {
          const statusElement = document.getElementById("status-message");
          const statusIndicator =
            statusElement.querySelector(".status-indicator");

          if (data.status === "healthy") {
            statusIndicator.className = "status-indicator status-success";
            statusElement.innerHTML = `
              <span class="status-indicator status-success"></span>
              API is running: ${data.status}
            `;
          } else {
            statusIndicator.className = "status-indicator status-error";
            statusElement.innerHTML = `
              <span class="status-indicator status-error"></span>
              API status: ${data.status}
            `;
          }
        })
        .catch((error) => {
          const statusElement = document.getElementById("status-message");
          statusElement.innerHTML = `
            <span class="status-indicator status-error"></span>
            API connection failed: ${error.message}
          `;
        });
    </script>

    <!-- Debug panel -->
    <div id="debug-panel" style="display: none">
      <h4>Debug Info</h4>
      <div id="debug-content"></div>
    </div>

    <script>
      // Simple debug helper
      window.HU_DEBUG = {
        log: function (msg) {
          console.log("[HU_DEBUG]", msg);
          const panel = document.getElementById("debug-panel");
          const content = document.getElementById("debug-content");
          if (panel && content) {
            panel.style.display = "block";
            const logLine = document.createElement("div");
            logLine.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            content.appendChild(logLine);
          }
        },
      };

      // Log page load
      document.addEventListener("DOMContentLoaded", function () {
        window.HU_DEBUG.log("DOM loaded");
        window.HU_DEBUG.log(`React available: ${!!window.React}`);
        window.HU_DEBUG.log(`ReactDOM available: ${!!window.ReactDOM}`);
      });
    </script>

    <!-- Load main application script -->
    <script type="module" src="/index.js"></script>
  </body>
</html>
