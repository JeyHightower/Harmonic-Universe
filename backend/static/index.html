<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Initialize flags to prevent multiple script execution -->
    <script>
      // Simple flag to prevent duplicate execution
      window.__UTILS_FIX_APPLIED__ = false;
      window.__COMPLETE_FIX_APPLIED__ = false;
    </script>

    <!-- Add debug script -->
    <script src="/debug.js"></script>

    <!-- Simple version patch with no recursion risk -->
    <script src="/version-patch.js"></script>

    <!-- IMPORTANT: Remove or comment out previous fix scripts -->
    <!-- <script src="/complete-fix.js"></script> -->
    <!-- <script src="/ant-icons-patch.js"></script> -->
    <!-- <script src="/utils-fix.js"></script> -->
    <!-- <script src="/ant-design-polyfill.js"></script> -->
    <!-- <script src="/react-polyfill.js"></script> -->
    <!-- <script src="/react-context-provider.js"></script> -->

    <!-- Add global error handler for script loading -->
    <script>
      // Create a global error handler for script loading
      window.addEventListener(
        "error",
        function (e) {
          if (e.target && e.target.src && e.target.src.includes("ant-icons")) {
            console.warn("Error loading ant-icons, creating fallback");

            // Create mock IconContext if React exists
            if (window.React && window.React.createContext) {
              window.IconContext = window.React.createContext({});
            } else {
              // Basic fallback if React isn't available
              window.IconContext = {
                Provider: function (props) {
                  return props.children;
                },
                Consumer: function (props) {
                  return props.children({});
                },
              };
            }

            // Prevent error from showing in console
            e.preventDefault();
          }
        },
        true
      );
    </script>

    <!-- Ant Design Icons with fallback -->
    <script>
      window.antIconsLoaded = false;
    </script>
    <script
      src="/ant-icons.js"
      onerror="console.error('Failed to load Ant Icons, using fallback'); document.write('<script src=\'/ant-icons-fallback.js\'><\/script>')"
    ></script>
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Explore the fascinating connection between music and physics with Harmonic Universe"
    />
    <title>Harmonic Universe</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script type="module" crossorigin src="./assets/index-Cqme2zdk.js"></script>
    <link rel="modulepreload" crossorigin href="./assets/vendor-C7BCHqNS.js" />
    <link
      rel="modulepreload"
      crossorigin
      href="./assets/ant-design-BPZweP9f.js"
    />
    <link
      rel="modulepreload"
      crossorigin
      href="./assets/ant-icons-BVj3fsgN.js"
    />
    <link rel="stylesheet" crossorigin href="./assets/index-YhiCDp85.css" />

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
        color: #333;
      }
      #root {
        min-height: 100vh;
      }
      .loading-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        text-align: center;
      }
      .error-container {
        display: none;
        margin-top: 2rem;
        padding: 1rem;
        background-color: #fff8f8;
        border-left: 4px solid #e74c3c;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }
      .loading-animation {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 1rem;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <noscript>
      <div style="text-align: center; padding: 2rem">
        <h1>JavaScript Required</h1>
        <p>You need to enable JavaScript to run this application.</p>
      </div>
    </noscript>

    <!-- React Fix Loader - ensures proper module loading -->
    <script src="/static/react-fixes/react-fix-loader.js"></script>

    <div id="root">
      <!-- Initial loading state that will be replaced by React -->
      <div class="loading-container">
        <div class="loading-animation"></div>
        <h1>Harmonic Universe</h1>
        <p>Loading application...</p>
        <div id="error-message" class="error-container"></div>
      </div>
    </div>

    <header>
      <h1>Harmonic Universe</h1>
      <p>Interactive Music Experience</p>
    </header>

    <main>
      <h2>Welcome!</h2>
      <p>
        The Harmonic Universe application is designed to provide a unique
        interactive musical experience where you can create, share, and explore
        music in new ways.
      </p>

      <p>
        This is a static fallback page that indicates your application's backend
        is running, but the full frontend experience may not be available at the
        moment.
      </p>

      <div class="status-box">
        <h3>Application Status</h3>
        <p id="status-message">
          <span class="status-indicator status-loading"></span>
          Checking API connection...
        </p>
        <p id="environment-info">Environment: Production</p>
        <p id="deployment-info">Created on: <span id="creation-date"></span></p>
      </div>
    </main>

    <footer>
      <p>Harmonic Universe &copy; 2023 - A Musical Experience</p>
    </footer>

    <script>
      // Set the creation date
      document.getElementById("creation-date").textContent =
        new Date().toLocaleString();

      // Check API status
      fetch("/api/health")
        .then((response) => response.json())
        .then((data) => {
          const statusElement = document.getElementById("status-message");
          const statusIndicator =
            statusElement.querySelector(".status-indicator");

          if (data.status === "healthy") {
            statusIndicator.className = "status-indicator status-success";
            statusElement.innerHTML = `
              <span class="status-indicator status-success"></span>
              API is running: ${data.status}
            `;
          } else {
            statusIndicator.className = "status-indicator status-error";
            statusElement.innerHTML = `
              <span class="status-indicator status-error"></span>
              API status: ${data.status}
            `;
          }
        })
        .catch((error) => {
          const statusElement = document.getElementById("status-message");
          statusElement.innerHTML = `
            <span class="status-indicator status-error"></span>
            API connection failed: ${error.message}
          `;
        });
    </script>

    <!-- Debug container to track loading status -->
    <div id="debug-status" style="display: none"></div>

    <script>
      // Track loading process
      const debug = document.getElementById("debug-status");

      function logStatus(message) {
        if (debug) {
          debug.innerHTML += `<div>${new Date()
            .toISOString()
            .slice(11, 19)} - ${message}</div>`;
          console.log(message);
        }
      }

      logStatus("Page loaded");

      // Track asset loading
      document.addEventListener("DOMContentLoaded", function () {
        logStatus("DOMContentLoaded fired");

        // Check if the main script has loaded correctly
        setTimeout(function () {
          const rootEl = document.getElementById("root");
          const errorEl = document.getElementById("error-message");

          // If the root still only contains the loading container, we likely have an issue
          if (rootEl && rootEl.innerHTML.includes("Loading application")) {
            logStatus("Application failed to load after timeout");

            if (errorEl) {
              errorEl.style.display = "block";
              errorEl.innerHTML = `
                <h3>Application Load Timeout</h3>
                <p>The application hasn't loaded properly. This might be due to:</p>
                <ul>
                  <li>JavaScript files not loading correctly</li>
                  <li>Network connectivity issues</li>
                  <li>Application initialization errors</li>
                </ul>
                <p>You can try:</p>
                <button onclick="window.location.reload()">Reload Page</button>
                <button onclick="window.location.href='/diagnostic.html'">Go to Diagnostics</button>
              `;
            }

            // Try to fetch the health API to see if backend is working
            fetch("/api/health")
              .then((response) => response.json())
              .then((data) => {
                logStatus(`API health check: ${JSON.stringify(data)}`);
              })
              .catch((err) => {
                logStatus(`API health check failed: ${err.message}`);
              });
          } else {
            logStatus("Application appears to be loading");
          }
        }, 5000);
      });

      // Global error handler
      window.addEventListener("error", function (e) {
        logStatus(`Error: ${e.message} (${e.filename}:${e.lineno})`);

        const errorEl = document.getElementById("error-message");
        if (errorEl) {
          errorEl.style.display = "block";
          errorEl.innerHTML = `
            <h3>JavaScript Error</h3>
            <p>An error occurred while loading the application:</p>
            <pre style="background:#f7f7f7;padding:10px;overflow:auto;max-width:100%;">${e.message}</pre>
            <p>You can try:</p>
            <button onclick="window.location.reload()">Reload Page</button>
            <button onclick="window.location.href='/diagnostic.html'">Go to Diagnostics</button>
          `;
        }
      });
    </script>

    <!-- Load main application script -->
    <script type="module" src="/assets/index.js"></script>
  </body>
</html>
