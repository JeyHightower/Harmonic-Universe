#!/bin/bash

# Exit on error
set -e

echo "Running pre-commit checks..."

# Get list of staged Python files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=d | grep ".py$" || true)

if [ -z "$STAGED_FILES" ]; then
    echo "No Python files to check."
    exit 0
fi

# Activate virtual environment if it exists
if [ -d "venv" ]; then
    source venv/bin/activate
fi

# Run black on staged files
echo "Running black..."
black --check $STAGED_FILES

# Run flake8
echo "Running flake8..."
flake8 $STAGED_FILES

# Run isort
echo "Running isort..."
isort --check-only $STAGED_FILES

# Run mypy
echo "Running mypy..."
mypy $STAGED_FILES

# Run tests
echo "Running tests..."
pytest

# If we got here, all checks passed
echo "All checks passed!"
exit 0
