services:
  - type: web
    name: harmonic-universe
    env: python
    buildCommand: |
      cd backend && \
      pip install -r requirements.txt && \
      export FLASK_APP=app.py && \
      export PYTHONPATH=$PYTHONPATH:$(pwd) && \
      python -c "import os, sys; sys.path.insert(0, os.getcwd()); import app; app.db.create_all(); print('Database setup complete')" && \
      cd ../frontend && \
      npm install && \
      npm run build
    startCommand: cd backend && gunicorn --workers=2 app:app
    envVars:
      - key: FLASK_APP
        value: app.py
      - key: PYTHON_VERSION
        value: 3.11.0
      - fromGroup: harmonic-universe-env
    healthCheckPath: /api/health
    autoDeploy: true

databases:
  - name: harmonic_universe_db
    plan: free
    postgresMajorVersion: 15

envVarGroups:
  - name: harmonic-universe-env 