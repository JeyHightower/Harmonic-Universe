import{r as e,j as t}from"./vendor-react-core.73efc664.js";import{P as n}from"./vendor-react-props.65efe0a6.js";import r from"./app-services-api.399edcf9.js";import"./vendor-react-redux.ca23f922.js";import"./app-redux-character-slice.77cb9e4b.js";import"./app-redux-character-thunks.c46623e8.js";import{a}from"./app-characters-components.a508a592.js";import"./app-redux-other-slices.a7022ed8.js";import"./app-utils.cd93f9c5.js";import{h as s}from"./vendor-tone-dist.6485732f.js";import{d as i}from"./vendor-tone-dayjs.54e2289e.js";import{F as o}from"./vendor-tone-form.6dd4e248.js";import{S as l}from"./vendor-tone-spin.d13f75fd.js";import{C as c}from"./vendor-tone-card.8385b307.js";import{A as d}from"./vendor-tone-alert.89362924.js";import{W as m,A as u,k as p}from"./vendor-tone-icons.388eb8da.js";import{R as f,C as h}from"./vendor-tone-grid.9235ce83.js";import{I as y}from"./vendor-tone-input.876080ec.js";import{D as j}from"./vendor-tone-divider.a6c32c3c.js";import{D as x}from"./vendor-tone-date-picker.3f71bbe3.js";import{S as g}from"./vendor-tone-select.c6c7620f.js";import{R as v}from"./vendor-tone-radio.0de19148.js";import{S}from"./vendor-tone-space.95ee87ca.js";import{B as b}from"./vendor-tone-button.429dcaea.js";import{T as _}from"./vendor-tone-typography.2404bb54.js";import{m as O}from"./vendor-tone-message.06244fbe.js";const{TextArea:I}=y,{Option:C}=g,{Title:w,Text:D}=_,T={formCard:{boxShadow:"none",border:"1px solid #f0f0f0",borderRadius:"8px",marginBottom:"24px"},detailsCard:{marginBottom:"24px"},contentCard:{marginBottom:"24px"},formSection:{marginBottom:"24px"},formTitle:{fontSize:"18px",fontWeight:600,marginBottom:"16px"},inputLabel:{fontWeight:500},contentTextarea:{minHeight:"200px",fontSize:"14px",lineHeight:1.6},modalOverride:{zIndex:1100}},q=({universeId:n,sceneId:_,initialData:q,onSubmit:E,onCancel:F,readOnly:L=!1,registerSubmit:N,initialValues:B})=>{const[P]=o.useForm(),[k,z]=e.useState(!1),[A,V]=e.useState(!1),[R,M]=e.useState([]),[W,Y]=e.useState(null),G=!!_;e.useEffect((()=>{if(q){const e={name:q.name||q.title,description:q.description,summary:q.summary,content:q.content,notes:q.notes,location:q.location,scene_type:q.scene_type||"default",timeOfDay:q.time_of_day||q.timeOfDay,status:q.status||"draft",significance:q.significance||"minor",characterIds:q.character_ids||q.characterIds||[],order:q.order||0,dateOfScene:q.dateOfScene||q.date_of_scene?s(q.dateOfScene||q.date_of_scene):null};P.setFieldsValue(e)}}),[q,P]),e.useEffect((()=>{if(_&&!q){(async()=>{var e;try{z(!0),Y(null);const t=await r.getScene(_),n=(null==(e=t.data)?void 0:e.scene)||t.data;if(n){const e={name:n.name||n.title,description:n.description,summary:n.summary,content:n.content,notes:n.notes,location:n.location,scene_type:n.scene_type||"default",timeOfDay:n.time_of_day||n.timeOfDay,status:n.status||"draft",significance:n.significance||"minor",characterIds:n.character_ids||n.characterIds||[],order:n.order||0,dateOfScene:n.dateOfScene||n.date_of_scene?s(n.dateOfScene||n.date_of_scene):null};P.setFieldsValue(e)}}catch(t){Y("Failed to load scene data. Please try refreshing the page."),O.error("Failed to load scene data")}finally{z(!1)}})()}}),[_,q,P]),e.useEffect((()=>{(async()=>{var e;if(n)try{const t=await r.getCharactersByUniverse(n),a=(null==(e=t.data)?void 0:e.characters)||t.data||[];M(a)}catch(t){M([]),notification.error({message:"Failed to load characters",description:"Please try again or contact support if the issue persists."})}})()}),[n]),e.useEffect((()=>{N&&"function"==typeof N&&N((()=>{P.submit()}))}),[N,P]),e.useEffect((()=>{if(B){const t={...B,timeOfDay:B.time_of_day||B.timeOfDay,characterIds:B.character_ids||B.characterIds||[]};if(B.date_of_scene)try{const e=i(B.date_of_scene);e.isValid()?t.dateOfScene=e:t.dateOfScene=null}catch(e){t.dateOfScene=null}else t.dateOfScene=null;P.setFieldsValue(t)}else G&&_||P.setFieldsValue({title:"",description:"",summary:"",universe_id:n})}),[B,P,G,_,n]);const H=e.useCallback((e=>e.parentNode||document.body),[]),U=()=>{document.querySelectorAll(".ant-select-dropdown:not(.ant-select-dropdown-hidden)").forEach((e=>{var t;const n=null==(t=e.getAttribute("id"))?void 0:t.replace("-popup","");if(n){const e=document.getElementById(n);e&&e.blur()}}))};return k?t.jsxs("div",{className:"form-loading-container",style:{textAlign:"center",padding:"3rem"},children:[t.jsx(l,{size:"large"}),t.jsx("p",{style:{marginTop:"1rem",fontSize:"16px"},children:"Loading scene data..."})]}):t.jsx("div",{className:"scene-form-container",children:t.jsxs(c,{bordered:!1,className:"scene-form-card main-form-card",style:T.formCard,children:[t.jsx(w,{level:4,className:"form-section-title",style:T.formTitle,children:G?"Edit Scene Details":"Create New Scene"}),t.jsxs(D,{type:"secondary",style:{marginBottom:"24px",display:"block"},children:["Fill in the information below to ",G?"update":"create"," ","your scene"]}),W&&t.jsx(d,{message:"Error",description:W,type:"error",showIcon:!0,icon:t.jsx(m,{}),style:{marginBottom:"24px"},closable:!0}),t.jsxs(o,{form:P,layout:"vertical",onFinish:async e=>{var t,r,a,s;try{if(!e.name||""===e.name.trim())throw O.error("Scene name is required"),new Error("Scene name is required");if(!e.summary||""===e.summary.trim())throw O.error("Scene summary is required"),new Error("Scene summary is required");const i=P.getFieldsValue(!0),o={...e,universe_id:n,id:_||void 0,name:null==(t=e.name)?void 0:t.trim(),time_of_day:e.timeOfDay||e.time_of_day||null,date_of_scene:e.dateOfScene?e.dateOfScene.toISOString?e.dateOfScene.toISOString():e.dateOfScene:e.date_of_scene?e.date_of_scene:null,title:null==(r=e.name)?void 0:r.trim(),description:e.description||null,summary:e.summary||e.description||"",content:e.content||null,notes:e.notes||null,location:e.location||null,scene_type:e.scene_type||"default",status:e.status||"draft",significance:e.significance||"minor",order:e.order||0,is_public:e.is_public||!1,is_deleted:!1};if(o.name,o.name&&""!==o.name.trim()||(o.name=(null==(a=i.name)?void 0:a.trim())||"Untitled Scene"),o.summary&&""!==o.summary.trim()||(o.summary=(null==(s=i.summary)?void 0:s.trim())||o.description||"No summary provided"),!o.name)throw O.error("Scene name is required"),new Error("Scene name is required");if(!o.summary)throw O.error("Scene summary is required"),new Error("Scene summary is required");const l=G?"update":"create",c=await E(l,o);return O.success(`Scene ${G?"updated":"created"} successfully!`),F&&F(),c}catch(i){throw O.error(i.message||"Failed to save scene"),i}},disabled:L,className:"scene-form",style:{marginTop:"24px"},initialValues:{status:"draft",significance:"minor",scene_type:"default",order:0},children:[t.jsxs(f,{gutter:[24,16],children:[t.jsx(h,{xs:24,lg:16,children:t.jsxs(c,{className:"scene-form-card content-card",title:t.jsx(w,{level:4,children:"Scene Details"}),style:T.contentCard,bordered:!0,children:[t.jsx(o.Item,{name:"name",label:t.jsx("span",{style:T.inputLabel,children:"Scene Name"}),rules:[{required:!0,message:"Please enter a scene name"}],children:t.jsx(y,{placeholder:"Enter scene name",disabled:L,size:"large"})}),t.jsx(o.Item,{name:"description",label:t.jsx("span",{style:T.inputLabel,children:"Description"}),children:t.jsx(y,{placeholder:"Short description of the scene",disabled:L})}),t.jsx(o.Item,{name:"summary",label:t.jsx("span",{style:T.inputLabel,children:"Summary"}),rules:[{required:!0,message:"Please enter a scene summary"}],children:t.jsx(I,{rows:3,placeholder:"Brief summary of the scene",maxLength:200,showCount:!0,disabled:L})}),t.jsx(j,{orientation:"left",children:"Scene Content"}),t.jsx(o.Item,{name:"content",label:t.jsx("span",{style:T.inputLabel,children:"Scene Content"}),rules:[{required:!0,message:"Please enter scene content"}],children:t.jsx(I,{rows:6,placeholder:"Full content of the scene",className:"content-textarea",disabled:L,style:T.contentTextarea})}),t.jsx(o.Item,{name:"notes",label:t.jsx("span",{style:T.inputLabel,children:"Writer's Notes"}),children:t.jsx(I,{rows:3,placeholder:"Additional notes about the scene (for writer reference only)",disabled:L})})]})}),t.jsx(h,{xs:24,lg:8,children:t.jsxs(c,{className:"properties-card",title:t.jsx(w,{level:4,children:"Properties"}),style:T.detailsCard,bordered:!0,children:[t.jsx(o.Item,{name:"location",label:t.jsx("span",{style:T.inputLabel,children:"Location"}),children:t.jsx(y,{placeholder:"Where the scene takes place",disabled:L})}),t.jsx(o.Item,{name:"dateOfScene",label:t.jsx("span",{style:T.inputLabel,children:"Date of Scene"}),children:t.jsx(x,{format:"YYYY-MM-DD",style:{width:"100%"},disabled:L,getPopupContainer:H,onOpenChange:e=>{e||setTimeout((()=>{P.validateFields(["dateOfScene"])}),100)},popupStyle:{...T.modalOverride},autoComplete:"off"})}),t.jsx(o.Item,{name:"timeOfDay",label:t.jsx("span",{style:T.inputLabel,children:"Time of Day"}),children:t.jsxs(g,{placeholder:"Select time of day",disabled:L,getPopupContainer:H,dropdownStyle:{...T.modalOverride},onBlur:U,autoComplete:"off",children:[t.jsx(C,{value:"morning",children:"Morning"}),t.jsx(C,{value:"afternoon",children:"Afternoon"}),t.jsx(C,{value:"evening",children:"Evening"}),t.jsx(C,{value:"night",children:"Night"})]})}),t.jsx(o.Item,{name:"status",label:t.jsx("span",{style:T.inputLabel,children:"Status"}),children:t.jsxs(v.Group,{disabled:L,children:[t.jsx(v,{value:"draft",children:"Draft"}),t.jsx(v,{value:"review",children:"Review"}),t.jsx(v,{value:"complete",children:"Complete"})]})}),t.jsx(o.Item,{name:"significance",label:t.jsx("span",{style:T.inputLabel,children:"Significance"}),children:t.jsxs(v.Group,{disabled:L,children:[t.jsx(v,{value:"minor",children:"Minor"}),t.jsx(v,{value:"major",children:"Major"}),t.jsx(v,{value:"pivotal",children:"Pivotal"})]})}),t.jsx(j,{orientation:"left",children:"Characters"}),t.jsx(o.Item,{name:"characterIds",label:t.jsx("span",{style:T.inputLabel,children:"Characters in Scene"}),children:t.jsx(a,{universeId:n,characters:R,disabled:L,getPopupContainer:H,onBlur:U})})]})})]}),t.jsx(j,{style:{margin:"32px 0 24px"}}),!L&&t.jsx(o.Item,{className:"form-actions",style:{marginBottom:0,textAlign:"right"},children:t.jsxs(S,{size:"middle",children:[t.jsx(b,{size:"large",onClick:()=>{F&&F()},icon:t.jsx(u,{}),children:"Cancel"}),t.jsxs(b,{type:"primary",htmlType:"submit",loading:A,size:"large",icon:t.jsx(p,{}),children:[G?"Save":"Create"," Scene"]})]})})]})]})})};q.propTypes={universeId:n.oneOfType([n.string,n.number]).isRequired,sceneId:n.oneOfType([n.string,n.number]),initialData:n.object,onSubmit:n.func.isRequired,onCancel:n.func.isRequired,readOnly:n.bool,registerSubmit:n.func,initialValues:n.object};export{q as S};
