import{m as t,n as e,p as s,q as i,u as a,v as o,w as n,x as r,y as h,z as l,B as u,C as c,D as p,E as d,H as _,I as f,J as v,K as m,L as b,o as E,S as g,M as y,N as T,Q as k,R as x,U as S,f as w,V as O,W as R,e as A,X as z,Y as V,i as D}from"./vendor-tone-core-base.398f9a2a.js";import{g as L,E as M}from"./vendor-tone-audio.70450c41.js";var q={passive:!0};const j={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var s=e.state,i=e.instance,a=e.options,o=a.scroll,n=void 0===o||o,r=a.resize,h=void 0===r||r,l=t(s.elements.popper),u=[].concat(s.scrollParents.reference,s.scrollParents.popper);return n&&u.forEach((function(t){t.addEventListener("scroll",i.update,q)})),h&&l.addEventListener("resize",i.update,q),function(){n&&u.forEach((function(t){t.removeEventListener("scroll",i.update,q)})),h&&l.removeEventListener("resize",i.update,q)}},data:{}};const B={name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var b=t.state,E=t.options,g=t.name,y=E.mainAxis,T=void 0===y||y,k=E.altAxis,x=void 0!==k&&k,S=E.boundary,w=E.rootBoundary,O=E.altBoundary,R=E.padding,A=E.tether,z=void 0===A||A,V=E.tetherOffset,D=void 0===V?0:V,L=e(b,{boundary:S,rootBoundary:w,padding:R,altBoundary:O}),M=s(b.placement),q=i(b.placement),j=!q,B=l(M),C=u(B),I=b.modifiersData.popperOffsets,P=b.rects.reference,N=b.rects.popper,U="function"==typeof D?D(Object.assign({},b.rects,{placement:b.placement})):D,F="number"==typeof U?{mainAxis:U,altAxis:U}:Object.assign({mainAxis:0,altAxis:0},U),H=b.modifiersData.offset?b.modifiersData.offset[b.placement]:null,W={x:0,y:0};if(I){if(T){var J,K="y"===B?c:p,Q="y"===B?d:_,X="y"===B?"height":"width",Y=I[B],G=Y+L[K],Z=Y-L[Q],$=z?-N[X]/2:0,tt=q===a?P[X]:N[X],et=q===a?-N[X]:-P[X],st=b.elements.arrow,it=z&&st?o(st):{width:0,height:0},at=b.modifiersData["arrow#persistent"]?b.modifiersData["arrow#persistent"].padding:n(),ot=at[K],nt=at[Q],rt=r(0,P[X],it[X]),ht=j?P[X]/2-$-rt-ot-F.mainAxis:tt-rt-ot-F.mainAxis,lt=j?-P[X]/2+$+rt+nt+F.mainAxis:et+rt+nt+F.mainAxis,ut=b.elements.arrow&&h(b.elements.arrow),ct=ut?"y"===B?ut.clientTop||0:ut.clientLeft||0:0,pt=null!=(J=null==H?void 0:H[B])?J:0,dt=Y+lt-pt,_t=r(z?v(G,Y+ht-pt-ct):G,Y,z?f(Z,dt):Z);I[B]=_t,W[B]=_t-Y}if(x){var ft,vt="x"===B?c:p,mt="x"===B?d:_,bt=I[C],Et="y"===C?"height":"width",gt=bt+L[vt],yt=bt-L[mt],Tt=-1!==[c,p].indexOf(M),kt=null!=(ft=null==H?void 0:H[C])?ft:0,xt=Tt?gt:bt-P[Et]-N[Et]-kt+F.altAxis,St=Tt?bt+P[Et]+N[Et]-kt-F.altAxis:yt,wt=z&&Tt?m(xt,bt,St):r(z?xt:gt,bt,z?St:yt);I[C]=wt,W[C]=wt-bt}b.modifiersData[g]=W}},requiresIfExists:["offset"]},C=(t,e,s)=>({endTime:e,insertTime:s,type:"exponentialRampToValue",value:t}),I=(t,e,s)=>({endTime:e,insertTime:s,type:"linearRampToValue",value:t}),P=(t,e)=>({startTime:e,type:"setValue",value:t}),N=(t,e,s)=>({duration:s,startTime:e,type:"setValueCurve",values:t}),U=(t,e,{startTime:s,target:i,timeConstant:a})=>i+(e-i)*Math.exp((s-t)/a),F=t=>"exponentialRampToValue"===t.type,H=t=>"linearRampToValue"===t.type,W=t=>F(t)||H(t),J=t=>"setValue"===t.type,K=t=>"setValueCurve"===t.type,Q=(t,e,s,i)=>{const a=t[e];return void 0===a?i:W(a)||J(a)?a.value:K(a)?a.values[a.values.length-1]:U(s,Q(t,e-1,a.startTime,i),a)},X=(t,e,s,i,a)=>void 0===s?[i.insertTime,a]:W(s)?[s.endTime,s.value]:J(s)?[s.startTime,s.value]:K(s)?[s.startTime+s.duration,s.values[s.values.length-1]]:[s.startTime,Q(t,e-1,s.startTime,a)],Y=t=>"cancelAndHold"===t.type,G=t=>"cancelScheduledValues"===t.type,Z=t=>Y(t)||G(t)?t.cancelTime:F(t)||H(t)?t.endTime:t.startTime,$=(t,e,s,{endTime:i,value:a})=>s===a?a:0<s&&0<a||s<0&&a<0?s*(a/s)**((t-e)/(i-e)):0,tt=(t,e,s,{endTime:i,value:a})=>s+(t-e)/(i-e)*(a-s),et=(t,{duration:e,startTime:s,values:i})=>((t,e)=>{const s=Math.floor(e),i=Math.ceil(e);return s===i?t[s]:(1-(e-s))*t[s]+(1-(i-e))*t[i]})(i,(t-s)/e*(i.length-1)),st=t=>"setTarget"===t.type;class it{constructor(t){this._automationEvents=[],this._currenTime=0,this._defaultValue=t}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(t){const e=Z(t);if(Y(t)||G(t)){const s=this._automationEvents.findIndex((s=>G(t)&&K(s)?s.startTime+s.duration>=e:Z(s)>=e)),i=this._automationEvents[s];if(-1!==s&&(this._automationEvents=this._automationEvents.slice(0,s)),Y(t)){const t=this._automationEvents[this._automationEvents.length-1];if(void 0!==i&&W(i)){if(void 0!==t&&st(t))throw new Error("The internal list is malformed.");const s=void 0===t?i.insertTime:K(t)?t.startTime+t.duration:Z(t),a=void 0===t?this._defaultValue:K(t)?t.values[t.values.length-1]:t.value,o=F(i)?$(e,s,a,i):tt(e,s,a,i),n=F(i)?C(o,e,this._currenTime):I(o,e,this._currenTime);this._automationEvents.push(n)}if(void 0!==t&&st(t)&&this._automationEvents.push(P(this.getValue(e),e)),void 0!==t&&K(t)&&t.startTime+t.duration>e){const s=e-t.startTime,i=(t.values.length-1)/t.duration,a=Math.max(2,1+Math.ceil(s*i)),o=s/(a-1)*i,n=t.values.slice(0,a);if(o<1)for(let e=1;e<a;e+=1){const s=o*e%1;n[e]=t.values[e-1]*(1-s)+t.values[e]*s}this._automationEvents[this._automationEvents.length-1]=N(n,t.startTime,s)}}}else{const s=this._automationEvents.findIndex((t=>Z(t)>e)),i=-1===s?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[s-1];if(void 0!==i&&K(i)&&Z(i)+i.duration>e)return!1;const a=F(t)?C(t.value,t.endTime,this._currenTime):H(t)?I(t.value,e,this._currenTime):t;if(-1===s)this._automationEvents.push(a);else{if(K(t)&&e+t.duration>Z(this._automationEvents[s]))return!1;this._automationEvents.splice(s,0,a)}}return!0}flush(t){const e=this._automationEvents.findIndex((e=>Z(e)>t));if(e>1){const t=this._automationEvents.slice(e-1),s=t[0];st(s)&&t.unshift(P(Q(this._automationEvents,e-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=t}}getValue(t){if(0===this._automationEvents.length)return this._defaultValue;const e=this._automationEvents.findIndex((e=>Z(e)>t)),s=this._automationEvents[e],i=(-1===e?this._automationEvents.length:e)-1,a=this._automationEvents[i];if(void 0!==a&&st(a)&&(void 0===s||!W(s)||s.insertTime>t))return U(t,Q(this._automationEvents,i-1,a.startTime,this._defaultValue),a);if(void 0!==a&&J(a)&&(void 0===s||!W(s)))return a.value;if(void 0!==a&&K(a)&&(void 0===s||!W(s)||a.startTime+a.duration>t))return t<a.startTime+a.duration?et(t,a):a.values[a.values.length-1];if(void 0!==a&&W(a)&&(void 0===s||!W(s)))return a.value;if(void 0!==s&&F(s)){const[e,o]=X(this._automationEvents,i,a,s,this._defaultValue);return $(t,e,o,s)}if(void 0!==s&&H(s)){const[e,o]=X(this._automationEvents,i,a,s,this._defaultValue);return tt(t,e,o,s)}return this._defaultValue}}const at=t=>({cancelTime:t,type:"cancelAndHold"}),ot=t=>({cancelTime:t,type:"cancelScheduledValues"}),nt=(t,e)=>({endTime:e,type:"exponentialRampToValue",value:t}),rt=(t,e)=>({endTime:e,type:"linearRampToValue",value:t}),ht=(t,e,s)=>({startTime:e,target:t,timeConstant:s,type:"setTarget"}),lt=t=>L(M,t),ut=(t,e)=>{if(!lt(t).delete(e))throw new Error("Missing the expected event listener.")},ct=t=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(e,s,i){if(null!==s){let a=this._listeners.get(s);void 0===a&&(a=t(this,s),"function"==typeof s&&this._listeners.set(s,a)),this._nativeEventTarget.addEventListener(e,a,i)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,s){const i=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===i?null:i,s)}},pt=(t,e)=>s=>{const i={value:t};return Object.defineProperties(s,{currentTarget:i,target:i}),"function"==typeof e?e.call(t,s):e.handleEvent.call(t,s)};class dt extends b{constructor(){super(E(dt.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new g("stopped"),this._startOffset=0;const t=E(dt.getDefaults(),arguments,["callback","value"]);this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(b.getDefaults(),{callback:y,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,(t=>{let e;if("started"===t.state){-1!==t.id&&this.context.transport.clear(t.id);const s=t.time+Math.round(this.startOffset/this._playbackRate);if(!0===this._loop||T(this._loop)&&this._loop>1){e=1/0,T(this._loop)&&(e=this._loop*this._getLoopDuration());const i=this._state.getAfter(s);null!==i&&(e=Math.min(e,i.time-s)),e!==1/0&&(e=new k(this.context,e));const a=new k(this.context,this._getLoopDuration());t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),a,new k(this.context,s),e)}else t.id=this.context.transport.schedule(this._tick.bind(this),new k(this.context,s))}}))}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){const e=this.toTicks(t);return"stopped"===this._state.getValueAtTime(e)&&(this._state.add({id:-1,state:"started",time:e}),this._rescheduleEvents(e)),this}stop(t){this.cancel(t);const e=this.toTicks(t);if("started"===this._state.getValueAtTime(e)){this._state.setStateAtTime("stopped",e,{id:-1});const t=this._state.getBefore(e);let s=e;null!==t&&(s=t.time),this._rescheduleEvents(s)}return this}cancel(t){t=S(t,-1/0);const e=this.toTicks(t);return this._state.forEachFrom(e,(t=>{this.context.transport.clear(t.id)})),this._state.cancel(e),this}_tick(t){const e=this.context.transport.getTicksAtTime(t);if(!this.mute&&"started"===this._state.getValueAtTime(e)){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let e=.02;x(this.humanize)||(e=this.toSeconds(this.humanize)),t+=(2*Math.random()-1)*e}this.callback(t,this.value)}}_getLoopDuration(){return(this._loopEnd-this._loopStart)/this._playbackRate}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new k(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new k(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const t=this.context.transport.ticks,e=this._state.get(t);if(null!==e&&"started"===e.state){const s=this._getLoopDuration();return(t-e.time)%s/s}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class _t extends dt{constructor(){super(E(_t.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new g("stopped"),this._events=new Set;const t=E(_t.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,t.events.forEach((t=>{w(t)?this.add(t[0],t[1]):this.add(t)}))}static getDefaults(){return Object.assign(dt.getDefaults(),{events:[]})}start(t,e){const s=this.toTicks(t);if("started"!==this._state.getValueAtTime(s)){e=S(e,this._loop?this._loopStart:0),e=this._loop?S(e,this._loopStart):S(e,0);const t=this.toTicks(e);this._state.add({id:-1,offset:t,state:"started",time:s}),this._forEach((e=>{this._startNote(e,s,t)}))}return this}_startNote(t,e,s){e-=s,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<s&&(e+=this._getLoopDuration()),t.start(new k(this.context,e))):t.startOffset<this._loopStart&&t.startOffset>=s&&(t.loop=!1,t.start(new k(this.context,e))):t.startOffset>=s&&t.start(new k(this.context,e))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach((t=>{t.startOffset+=this._startOffset}))}stop(t){const e=this.toTicks(t);return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._forEach((e=>{e.stop(t)})),this}at(t,e){const s=new O(this.context,t).toTicks(),i=new k(this.context,1).toSeconds(),a=this._events.values();let o=a.next();for(;!o.done;){const t=o.value;if(Math.abs(s-t.startOffset)<i)return R(e)&&(t.value=e),t;o=a.next()}return R(e)?(this.add(t,e),this.at(t)):null}add(t,e){t instanceof Object&&Reflect.has(t,"time")&&(t=(e=t).time);const s=this.toTicks(t);let i;return e instanceof dt?(i=e,i.callback=this._tick.bind(this)):i=new dt({callback:this._tick.bind(this),context:this.context,value:e}),i.startOffset=s,i.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(i),this._restartEvent(i),this}_restartEvent(t){this._state.forEach((e=>{"started"===e.state?this._startNote(t,e.time,e.offset):t.stop(new k(this.context,e.time))}))}remove(t,e){return A(t)&&t.hasOwnProperty("time")&&(t=(e=t).time),t=this.toTicks(t),this._events.forEach((s=>{s.startOffset===t&&(z(e)||R(e)&&s.value===e)&&(this._events.delete(s),s.dispose())})),this}clear(){return this._forEach((t=>t.dispose())),this._events.clear(),this}cancel(t){return this._forEach((e=>e.cancel(t))),this._state.cancel(this.toTicks(t)),this}_forEach(t){return this._events&&this._events.forEach((e=>{e instanceof _t?e._forEach(t):t(e)})),this}_setAll(t,e){this._forEach((s=>{s[t]=e}))}_tick(t,e){this.mute||this.callback(t,e)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):"stopped"===t.state&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(t){this._loop=t,this._forEach((e=>{e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.loop=t,this._testLoopBoundries(e)}))}get loopEnd(){return new k(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach((e=>{e.loopEnd=t,this._testLoopBoundries(e)}))}get loopStart(){return new k(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach((t=>{t.loopStart=this.loopStart,this._testLoopBoundries(t)}))}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}class ft extends dt{constructor(){super(E(ft.getDefaults(),arguments,["callback","events","subdivision"])),this.name="Sequence",this._part=new _t({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];const t=E(ft.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(t.subdivision),this.events=t.events,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.playbackRate=t.playbackRate,this.probability=t.probability,this.humanize=t.humanize,this.mute=t.mute,this.playbackRate=t.playbackRate}static getDefaults(){return Object.assign(V(dt.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(t,e){null===e||this.mute||this.callback(t,e)}get events(){return this._events}set events(t){this.clear(),this._eventsArray=t,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(t,e){return this._part.start(t,e?this._indexTime(e):e),this}stop(t){return this._part.stop(t),this}get subdivision(){return new k(this.context,this._subdivision).toSeconds()}_createSequence(t){return new Proxy(t,{get:(t,e)=>t[e],set:(t,e,s)=>(D(e)&&isFinite(parseInt(e,10))&&w(s)?t[e]=this._createSequence(s):t[e]=s,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(t,e,s){t.forEach(((t,i)=>{const a=i*e+s;if(w(t))this._rescheduleSequence(t,e/t.length,a);else{const e=new k(this.context,a,"i").toSeconds();this._part.add(e,t)}}))}_indexTime(t){return new k(this.context,t*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(t){this._part.loop=t}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this._part.loopStart=this._indexTime(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this._part.loopEnd=0===t?this._indexTime(this._eventsArray.length):this._indexTime(t)}get startOffset(){return this._part.startOffset}set startOffset(t){this._part.startOffset=t}get playbackRate(){return this._part.playbackRate}set playbackRate(t){this._part.playbackRate=t}get probability(){return this._part.probability}set probability(t){this._part.probability=t}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(t){this._part.humanize=t}get length(){return this._part.length}}export{it as A,ft as S,N as a,P as b,ct as c,ut as d,ht as e,rt as f,lt as g,nt as h,ot as i,at as j,j as k,B as p,pt as w};
