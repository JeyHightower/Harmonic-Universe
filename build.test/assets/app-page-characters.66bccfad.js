import{r as e,j as o}from"./vendor-react-core.73efc664.js";import{u as r,a as t}from"./vendor-react-redux.ca23f922.js";import"./app-redux-physics-thunks.c58b7b1a.js";import{C as n}from"./app-other-components.5e297c7e.js";import"./app-core.4fc76094.js";import s from"./app-services-api.399edcf9.js";import"./app-characters-components.a508a592.js";import{a as i}from"./app-redux-character-slice.77cb9e4b.js";import{b as a}from"./app-redux-character-thunks.c46623e8.js";import{a as d,u as p}from"./vendor-react-router.6468192e.js";import{B as m,C as c,G as j}from"./vendor-mui-layout.b03fb29f.js";import{C as l,T as v,A as u}from"./vendor-mui-core.4359195f.js";import{I as h,B as x}from"./vendor-mui-buttons.74e6c144.js";import{c as y,A as f,i as g,V as b,E as k,D as P}from"./vendor-mui-icons-other.bc15c9b6.js";import{T as C,b as S}from"./vendor-mui-inputs.b77362ac.js";import{C as I,a as w,b as A}from"./vendor-mui-card.3348f8fd.js";import"./vendor-tone-classnames.ea5eadd4.js";import"./vendor-tone-dist.6485732f.js";import"./vendor-tone-module.5bbe5778.js";import"./vendor-tone-util.a79eb63f.js";import"./vendor-tone-helpers.07e4d08d.js";import"./vendor-tone-platform.4f06f964.js";import"./vendor-tone-browser.dd42b0e8.js";import"./vendor-tone-classes.909fbaba.js";import"./vendor-tone-core-base.398f9a2a.js";import"./vendor-tone-defaults.617853c7.js";import"./vendor-tone-cancel.b93f499f.js";import"./vendor-tone-adapters.ec1cb8a7.js";import"./vendor-tone-lodash.1d9c6a83.js";import"./vendor-tone-events.9afa7530.js";import"./vendor-tone-audio.70450c41.js";import"./vendor-tone-source.0b4b1ccd.js";import"./vendor-tone-tslib.f5f62bcb.js";import"./vendor-tone-signal.648ab60f.js";import"./vendor-tone-components.680c7d7e.js";import"./vendor-tone-esm.8edb30e2.js";import"./vendor-tone-type.9e20d569.js";import"./vendor-tone-styled-engine.72d9b7d5.js";import"./vendor-emotion-styled.ae0fdb08.js";import"./vendor-emotion-core.fcf170e6.js";import"./vendor-tone-src.89c6b4f5.js";import"./vendor-tone-StyledEngineProvider.626b917c.js";import"./vendor-tone-GlobalStyles.58bf1e29.js";import"./vendor-tone-createTheme.6c673f08.js";import"./vendor-tone-styleFunctionSx.dbcb4226.js";import"./vendor-tone-instruments.3eb491c0.js";import"./vendor-tone-effects.66f8dc4e.js";import"./vendor-react-dom.e7130502.js";import"./vendor-react-scheduler.c51d43b5.js";import"./vendor-tone-hooks.ee856eec.js";import"./vendor-tone-es.9387ac1c.js";import"./vendor-tone-dist-web.442e5e08.js";import"./vendor-tone-Selector.7ca3b0ed.js";import"./vendor-tone-TimePanel.ca272323.js";import"./vendor-tone-panels.35d19878.js";import"./vendor-tone-DatetimePanel.eb5b0baf.js";import"./vendor-tone-DatePanel.9f66ebd0.js";import"./vendor-tone-WeekPanel.896778be.js";import"./vendor-tone-MonthPanel.70b7688e.js";import"./vendor-tone-QuarterPanel.144363f0.js";import"./vendor-tone-YearPanel.b92617d1.js";import"./vendor-tone-DecadePanel.8c0dc02f.js";import"./vendor-tone-TabPanelList.10481429.js";import"./vendor-tone-TabNavList.2513addc.js";import"./vendor-tone-Dialog.2ffc21c8.js";import"./vendor-tone-Content.9808c346.js";import"./vendor-tone-context.2287e470.js";import"./vendor-tone-SubMenu.1b0c3984.js";import"./vendor-tone-Popup.9ff27a32.js";import"./vendor-tone-SingleObserver.ddf11abe.js";import"./vendor-tone-icons.388eb8da.js";import"./vendor-tone-asn.f94d41fd.js";import"./vendor-tone-message.06244fbe.js";import"./vendor-tone-config-provider.2fc53c46.js";import"./vendor-tone-form.6dd4e248.js";import"./vendor-tone-grid.9235ce83.js";import"./vendor-tone-locale-provider.8d53e5b8.js";import"./vendor-tone-modal.4772d80b.js";import"./vendor-tone-button.429dcaea.js";import"./vendor-tone-space.95ee87ca.js";import"./vendor-tone-locale.9bc1cdd3.js";import"./vendor-tone-useModal.b905cda5.js";import"./vendor-tone-tooltip.4e7d946d.js";import"./vendor-tone-FormItem.7dbdfc6f.js";import"./vendor-tone-notification.2961f1bd.js";import"./vendor-tone-empty.6f888680.js";import"./vendor-tone-channel.a150b5c9.js";import"./vendor-tone-menu.86d2dba0.js";import"./vendor-tone-layout.4cbd4c32.js";import"./vendor-tone-useMediaQuery.95247262.js";import"./vendor-tone-useThemeProps.a5833127.js";import"./vendor-tone-validation.226ee14c.js";import"./vendor-tone-LocalizationProvider.b505657c.js";import"./vendor-tone-locales.e8ab67da.js";import"./vendor-tone-RtlProvider.df0b182e.js";import"./vendor-tone-constants.d67dcaf6.js";import"./vendor-mui-dialogs.59185291.js";import"./vendor-tone-env.26551821.js";import"./vendor-react-props.65efe0a6.js";import"./vendor-tone-shim.e999ecad.js";import"./vendor-tone-cjs.5d603e0b.js";import"./vendor-tone-use-sync-external-store-shim.d3746bbc.js";import"./vendor-redux-toolkit.fa18e013.js";import"./vendor-redux-core.f9606c35.js";import"./app-modals.11788519.js";import"./app-redux-scene-thunks.d96f7130.js";import"./app-redux-scene-slice.81f21730.js";import"./app-contexts.6347d155.js";import"./app-utils.cd93f9c5.js";import"./vendor-tone-lib.58935e90.js";import"./app-constants.4a812be2.js";import"./app-redux-other-slices.a7022ed8.js";import"./app-redux-auth-thunks.3612091e.js";import"./app-redux-auth-slice.749a10ad.js";import"./app-redux-note-slice.2ed79aa2.js";import"./app-redux-note-thunks.e47bcfeb.js";import"./vendor-mui-menus.328affd2.js";import"./vendor-mui-list.1c6188a6.js";import"./vendor-tone-system.c96386b3.js";import"./vendor-tone-select.c6c7620f.js";import"./vendor-tone-upload.27f9a3b5.js";import"./vendor-tone-UploadList.9372bedd.js";import"./vendor-tone-progress.cc741b51.js";import"./vendor-tone-card.8385b307.js";import"./vendor-tone-skeleton.45affeec.js";import"./vendor-tone-tabs.69cd71fe.js";import"./vendor-tone-switch.4218e0a6.js";import"./app-scenes-components.e3ba29e5.js";import"./app-scenes-form.07f7a30a.js";import"./vendor-tone-dayjs.54e2289e.js";import"./vendor-tone-spin.d13f75fd.js";import"./vendor-tone-alert.89362924.js";import"./vendor-tone-input.876080ec.js";import"./vendor-tone-divider.a6c32c3c.js";import"./vendor-tone-date-picker.3f71bbe3.js";import"./vendor-tone-tag.30f4ea2f.js";import"./vendor-tone-generate.3bd3dbc2.js";import"./vendor-tone-generatePicker.e957b148.js";import"./vendor-tone-radio.0de19148.js";import"./vendor-tone-typography.2404bb54.js";import"./vendor-tone-Base.81f829aa.js";import"./vendor-tone-copy-to-clipboard.e7f533f2.js";import"./vendor-tone-toggle-selection.c563a038.js";import"./app-services-other.47edd63d.js";import"./app-physics-components.dcafff4c.js";import"./app-physics-list.9dc0d346.js";import"./app-redux-physics-slice.b0d37703.js";import"./vendor-tone-input-number.28372503.js";import"./vendor-tone-DatePicker.de25fe8c.js";import"./vendor-tone-DesktopDatePicker.f7be1484.js";import"./vendor-tone-dateViewRenderers.da97565f.js";import"./vendor-tone-DateCalendar.07d8b1f1.js";import"./vendor-tone-PickersDay.36f5e5b8.js";import"./vendor-tone-PickersCalendarHeader.d19a4873.js";import"./vendor-tone-YearCalendar.53b1f79c.js";import"./vendor-tone-MonthCalendar.110ab177.js";import"./vendor-tone-DateField.a7ba308d.js";import"./vendor-tone-useField.40869926.js";import"./vendor-tone-PickersTextField.1b1b2159.js";import"./vendor-tone-PickersInput.177ec5f5.js";import"./vendor-tone-PickersInputBase.b4cbf25e.js";import"./vendor-tone-PickersSectionList.b3696c3f.js";import"./vendor-tone-PickersFilledInput.ea55e758.js";import"./vendor-tone-PickersOutlinedInput.cd7d73be.js";import"./vendor-tone-useDesktopPicker.83b3e221.js";import"./vendor-tone-usePicker.425377a1.js";import"./vendor-tone-PickersLayout.80c91798.js";import"./vendor-tone-PickersActionBar.6bdc4ff9.js";import"./vendor-tone-PickersShortcuts.51e2ec2a.js";import"./vendor-tone-MobileDatePicker.51f93f0c.js";import"./vendor-tone-useMobilePicker.b0b52352.js";import"./app-redux-core.93965072.js";import"./vendor-redux-persist.1ece7284.js";import"./app-routes.fd68d670.js";import"./vendor-tone-avatar.122bfb6a.js";import"./vendor-tone-popover.9c9808a5.js";import"./vendor-tone-Container.5ed3ed7d.js";import"./vendor-tone-Stack.f8b60d0c.js";import"./vendor-tone-DefaultPropsProvider.3d25d93b.js";const D=()=>{const{universeId:r}=d(),t=p(),[n,s]=e.useState(!0);if(e.useEffect((()=>{null!=r&&"undefined"!==r&&"null"!==r&&""!==r&&!isNaN(parseInt(r,10))&&parseInt(r,10)>0?s(!1):t("/dashboard",{replace:!0})}),[r,t]),n)return o.jsxs(m,{display:"flex",justifyContent:"center",my:6,children:[o.jsx(l,{}),o.jsx(v,{variant:"body1",sx:{ml:2},children:"Validating universe..."})]});const i=parseInt(r,10);return o.jsx(N,{universeId:i})},N=({universeId:d})=>{const D=p(),N=r(),L=d&&!isNaN(parseInt(d,10))&&parseInt(d,10)>0?parseInt(d,10):null,{universeCharacters:F,isLoading:T}=t((e=>e.characters)),B=d&&F[d]?F[d]:[],E=T,M=t((e=>e.characters.error)),[z,O]=e.useState(null),[R,V]=e.useState([]),[_,G]=e.useState(""),[Q,U]=e.useState(!1),[W,$]=e.useState("create"),[H,J]=e.useState(null);e.useEffect((()=>(d&&N(a(d)),()=>{N(i())})),[N,d]),e.useEffect((()=>{if(!L)return void setTimeout((()=>D("/dashboard",{replace:!0})),1500);L&&L>0&&(async()=>{var e,o;try{const i="harmonic_universe_character_cache";try{const e=localStorage.getItem(i);if(e){const o=JSON.parse(e)[L];o&&o.characters&&(Date.now(),o.timestamp)}}catch(r){}try{const r=await s.getUniverse(L,{includeScenes:!0});if(!r||!r.data)throw new Error("Failed to fetch universe data");const n=r.data.universe||{};O(n);let i=[];if((null==(e=r.data.universe)?void 0:e.scenes)&&Array.isArray(r.data.universe.scenes)?i=r.data.universe.scenes:r.data.scenes&&Array.isArray(r.data.scenes)&&(i=r.data.scenes),0===i.length)try{const e=await s.getUniverseScenes(L);if((null==(o=e.data)?void 0:o.scenes)&&Array.isArray(e.data.scenes))i=e.data.scenes;else if(Array.isArray(e.data))i=e.data;else if(e.data){const o=e.data;for(const e in o)if(Array.isArray(o[e])){const r=o[e];if(r.length>0&&(r[0].universe_id||r[0].id)){i=r;break}}}}catch(t){}V(i||[])}catch(n){O({}),V([])}}catch(i){}})()}),[L,D,N]);const Y=()=>{$("create"),J(null),U(!0)},q=()=>{L&&D(`/universes/${L}/scenes/new`)},K=B.filter((e=>e.name.toLowerCase().includes(_.toLowerCase())||e.description&&e.description.toLowerCase().includes(_.toLowerCase())));return o.jsxs(c,{maxWidth:"lg",className:"characters-page",children:[o.jsxs(m,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,children:[o.jsxs(m,{display:"flex",alignItems:"center",children:[o.jsx(h,{onClick:()=>{D(`/universes/${L}`)},sx:{mr:1},children:o.jsx(y,{})}),o.jsxs(v,{variant:"h4",component:"h1",children:["Characters ",z?`for ${z.name}`:""]})]}),o.jsx(x,{variant:"contained",color:"primary",startIcon:o.jsx(f,{}),onClick:Y,children:"Create Character"})]}),o.jsx(C,{fullWidth:!0,margin:"normal",placeholder:"Search characters...",value:_,onChange:e=>G(e.target.value),InputProps:{startAdornment:o.jsx(S,{position:"start",children:o.jsx(g,{})})},sx:{mb:4}}),0!==R.length||E?null:o.jsxs(m,{textAlign:"center",my:3,p:2,bgcolor:"#f5f5f5",borderRadius:1,children:[o.jsx(v,{variant:"h6",gutterBottom:!0,children:"No Scenes Available"}),o.jsx(v,{variant:"body2",color:"textSecondary",paragraph:!0,children:"Characters need to be placed in a scene. Create your first scene to get started."}),o.jsx(x,{variant:"contained",color:"primary",onClick:q,startIcon:o.jsx(f,{}),children:"Create First Scene"})]}),E?o.jsx(m,{display:"flex",justifyContent:"center",my:6,children:o.jsx(l,{})}):M?o.jsx(u,{severity:"error",sx:{my:2},children:"object"==typeof M?M.message||"Failed to load characters":M}):0===K.length?o.jsxs(m,{my:4,textAlign:"center",children:[o.jsx(v,{variant:"h6",color:"textSecondary",gutterBottom:!0,children:"No characters found"}),o.jsx(x,{variant:"contained",color:"primary",startIcon:o.jsx(f,{}),onClick:Y,sx:{mt:2},disabled:0===R.length,children:"Create your first character"})]}):o.jsx(j,{container:!0,spacing:3,children:K.map((e=>o.jsx(j,{item:!0,xs:12,sm:6,md:4,children:o.jsxs(I,{elevation:3,className:"character-card",children:[o.jsxs(w,{children:[o.jsx(v,{variant:"h6",component:"h2",className:"character-card-title",children:e.name}),o.jsx(v,{variant:"body2",color:"textSecondary",className:"character-card-description",children:e.description||"No description available"})]}),o.jsxs(A,{className:"character-card-actions",children:[o.jsx(h,{onClick:()=>{return o=e.id,$("view"),J(o),void U(!0);var o},size:"small",title:"View",children:o.jsx(b,{})}),o.jsx(h,{onClick:()=>{return o=e.id,$("edit"),J(o),void U(!0);var o},size:"small",title:"Edit",children:o.jsx(k,{})}),o.jsx(h,{onClick:()=>{return o=e.id,$("delete"),J(o),void U(!0);var o},size:"small",title:"Delete",color:"error",children:o.jsx(P,{})})]})]})},e.id)))}),Q&&o.jsx(n,{open:Q,onClose:()=>{U(!1),"create"===W&&J(null)},characterId:H,universeId:Number(L),mode:W,onSuccess:e=>{N(a(L))},availableScenes:R})]})};export{D as default};
