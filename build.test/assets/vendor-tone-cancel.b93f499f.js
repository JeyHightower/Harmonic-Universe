import{a as s}from"./vendor-tone-core-base.398f9a2a.js";import{aP as e}from"./vendor-tone-util.a79eb63f.js";function t(s){return!(!s||!s.__CANCEL__)}function n(e,t,n){s.call(this,null==e?"canceled":e,s.ERR_CANCELED,t,n),this.name="CanceledError"}e.inherits(n,s,{__CANCEL__:!0});class r{constructor(s){if("function"!=typeof s)throw new TypeError("executor must be a function.");let e;this.promise=new Promise((function(s){e=s}));const t=this;this.promise.then((s=>{if(!t._listeners)return;let e=t._listeners.length;for(;e-- >0;)t._listeners[e](s);t._listeners=null})),this.promise.then=s=>{let e;const n=new Promise((s=>{t.subscribe(s),e=s})).then(s);return n.cancel=function(){t.unsubscribe(e)},n},s((function(s,r,i){t.reason||(t.reason=new n(s,r,i),e(t.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){this.reason?s(this.reason):this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const e=this._listeners.indexOf(s);-1!==e&&this._listeners.splice(e,1)}toAbortSignal(){const s=new AbortController,e=e=>{s.abort(e)};return this.subscribe(e),s.signal.unsubscribe=()=>this.unsubscribe(e),s.signal}static source(){let s;return{token:new r((function(e){s=e})),cancel:s}}}const i=r;export{n as C,i as a,t as i};
