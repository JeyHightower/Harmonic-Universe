import{M as t,h as e,s,j as i,k as o,l as r,m as a,n,p as h,q as c,r as u}from"./vendor-tone-audio.70450c41.js";import{T as l,M as p,G as d,h as _,S as f,r as y,X as m,ab as g,U as S,ac as v,W as x,o as b,a8 as T,P as w,ad as q,ae as C,af as E,ag as O,O as N,ah as A,k as R,ai as k,N as D,i as M,t as I}from"./vendor-tone-core-base.398f9a2a.js";import{a as B,_ as j}from"./vendor-tone-tslib.f5f62bcb.js";import{S as V,A as F,M as P,W}from"./vendor-tone-signal.648ab60f.js";import{V as G}from"./vendor-tone-components.680c7d7e.js";const L={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},U=(r,a,n,h,c,u,l,p)=>class extends r{constructor(s,i){const o=u(s),r={...L,...i},h=c(o,r),p=l(o),d=p?a():null;super(s,!1,h,d),this._audioBufferSourceNodeRenderer=d,this._isBufferNullified=!1,this._isBufferSet=null!==r.buffer,this._nativeAudioBufferSourceNode=h,this._onended=null,this._playbackRate=n(this,p,h.playbackRate,t,e)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw h();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?p(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const s=this._nativeAudioBufferSourceNode.onended;this._onended=null!==s&&s===e?t:s}get playbackRate(){return this._playbackRate}start(t=0,e=0,r){if(this._nativeAudioBufferSourceNode.start(t,e,r),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===r?[t,e]:[t,e,r]),"closed"!==this.context.state){s(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),i(this)&&o(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}},z=(t,e,s,i,o)=>()=>{const a=new WeakMap;let n=null,h=null;return{set start(t){n=t},set stop(t){h=t},render(c,u){const l=a.get(u);return void 0!==l?Promise.resolve(l):(async(c,u)=>{let l=s(c);const p=r(l,u);if(!p){const t={buffer:l.buffer,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,loop:l.loop,loopEnd:l.loopEnd,loopStart:l.loopStart,playbackRate:l.playbackRate.value};l=e(u,t),null!==n&&l.start(...n),null!==h&&l.stop(h)}return a.set(u,l),p?await t(u,c.playbackRate,l.playbackRate):await i(u,c.playbackRate,l.playbackRate),await o(c,u,l),l})(c,u)}}},$=t=>"playbackRate"in t,H=t=>"offset"in t,X=t=>(e,s)=>{const i=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),o=e.createBuffer(1,2,44100);return i.buffer=o,i.loop=!0,i.connect(s),i.start(),()=>{i.stop(),i.disconnect(s)}},J={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},K=(r,a,n,h,c,u,l)=>class extends r{constructor(s,i){const o=c(s),r={...J,...i},l=h(o,r),p=u(o),d=p?n():null;super(s,!1,l,d),this._constantSourceNodeRenderer=d,this._nativeConstantSourceNode=l,this._offset=a(this,p,l.offset,t,e),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?l(this,t):null;this._nativeConstantSourceNode.onended=e;const s=this._nativeConstantSourceNode.onended;this._onended=null!==s&&s===e?t:s}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){s(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),i(this)&&o(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}},Q=(t,e,s,i,o)=>()=>{const a=new WeakMap;let n=null,h=null;return{set start(t){n=t},set stop(t){h=t},render(c,u){const l=a.get(u);return void 0!==l?Promise.resolve(l):(async(c,u)=>{let l=s(c);const p=r(l,u);if(!p){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,offset:l.offset.value};l=e(u,t),null!==n&&l.start(n),null!==h&&l.stop(h)}return a.set(u,l),p?await t(u,c.offset,l.offset):await i(u,c.offset,l.offset),await o(c,u,l),l})(c,u)}}},Y=t=>e=>new Promise(((s,i)=>{if(null===t)return void i(new SyntaxError);const o=t.document.head;if(null===o)i(new SyntaxError);else{const r=t.document.createElement("script"),a=new Blob([e],{type:"application/javascript"}),n=URL.createObjectURL(a),h=t.onerror,c=()=>{t.onerror=h,URL.revokeObjectURL(n)};t.onerror=(e,s,o,r,a)=>s===n||s===t.location.href&&1===o&&1===r?(c(),i(a),!1):null!==h?h(e,s,o,r,a):void 0,r.onerror=()=>{c(),i(new SyntaxError)},r.onload=()=>{c(),s()},r.src=n,r.type="module",o.appendChild(r)}})),Z=t=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw t()},tt=(t,e,s,i)=>class extends t{constructor(t,o){const r=s(t),a=e(r,o);if(i(r))throw TypeError();super(t,!0,a,null),this._nativeMediaElementAudioSourceNode=a}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},et=(t,e,s,i)=>class extends t{constructor(t,o){const r=s(t),a=e(r,o);if(i(r))throw new TypeError;super(t,!0,a,null),this._nativeMediaStreamAudioSourceNode=a}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},st=(t,e,s)=>class extends t{constructor(t,i){const o=s(t);super(t,!0,e(o,i),null)}},it=t=>{var e;t.start=(e=t.start,(s=0,i=0,o)=>{if("number"==typeof o&&o<0||i<0||s<0)throw new RangeError("The parameters can't be negative.");e.call(t,s,i,o)})},ot=t=>{var e;t.stop=(e=t.stop,(s=0)=>{if(s<0)throw new RangeError("The parameter can't be negative.");e.call(t,s)})},rt=(t,e,s,i,o,r,u,l,p,d,_)=>(f,y)=>{const m=f.createBufferSource();return n(m,y),h(m,y,"playbackRate"),c(m,y,"buffer"),c(m,y,"loop"),c(m,y,"loopEnd"),c(m,y,"loopStart"),e(s,(()=>s(f)))||(t=>{t.start=(e=>{let s=!1;return(i=0,o=0,r)=>{if(s)throw a();e.call(t,i,o,r),s=!0}})(t.start)})(m),e(i,(()=>i(f)))||p(m),e(o,(()=>o(f)))||d(m,f),e(r,(()=>r(f)))||it(m),e(u,(()=>u(f)))||_(m,f),e(l,(()=>l(f)))||ot(m),t(f,m),m},at=(t,e,s,i,o)=>(r,a)=>{if(void 0===r.createConstantSource)return s(r,a);const c=r.createConstantSource();return n(c,a),h(c,a,"offset"),e(i,(()=>i(r)))||it(c),e(o,(()=>o(r)))||ot(c),t(r,c),c},nt=(t,e,s,i)=>(o,{offset:r,...a})=>{const n=o.createBuffer(1,2,44100),h=e(o,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=s(o,{...a,gain:r}),l=n.getChannelData(0);l[0]=1,l[1]=1,h.buffer=n,h.loop=!0;const p={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(t){c.channelCount=t},get channelCountMode(){return c.channelCountMode},set channelCountMode(t){c.channelCountMode=t},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(t){c.channelInterpretation=t},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return h.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return h.onended},set onended(t){h.onended=t},addEventListener:(...t)=>h.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>h.dispatchEvent(t[0]),removeEventListener:(...t)=>h.removeEventListener(t[0],t[1],t[2]),start(t=0){h.start.call(h,t)},stop(t=0){h.stop.call(h,t)}};return t(o,h),i(u(p,c),(()=>h.connect(c)),(()=>h.disconnect(c)))},ht=(t,e)=>t.createMediaElementSource(e.mediaElement),ct=(t,{mediaStream:e})=>{const s=e.getAudioTracks();s.sort(((t,e)=>t.id<e.id?-1:t.id>e.id?1:0));const i=s.slice(0,1),o=t.createMediaStreamSource(new MediaStream(i));return Object.defineProperty(o,"mediaStream",{value:e}),o},ut=(t,e)=>(s,{mediaStreamTrack:i})=>{if("function"==typeof s.createMediaStreamTrackSource)return s.createMediaStreamTrackSource(i);const o=new MediaStream([i]),r=s.createMediaStreamSource(o);if("audio"!==i.kind)throw t();if(e(s))throw new TypeError;return r},lt=t=>(e,s)=>{const i=s.createBuffer(1,1,44100);null===e.buffer&&(e.buffer=i),t(e,"buffer",(t=>()=>{const s=t.call(e);return s===i?null:s}),(t=>s=>t.call(e,null===s?i:s)))},pt=t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},dt=t=>{const e=t.createBufferSource(),s=t.createBuffer(1,1,44100);e.buffer=s;try{e.start(0,1)}catch{return!1}return!0},_t=t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},ft=t=>{const e=t.createOscillator();try{e.start(-1)}catch(s){return s instanceof RangeError}return!1},yt=t=>{const e=t.createBuffer(1,1,44100),s=t.createBufferSource();s.buffer=e,s.start(),s.stop();try{return s.stop(),!0}catch{return!1}},mt=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(s){return s instanceof RangeError}return!1},gt=t=>{var e;t.start=(e=t.start,(s=0,i=0,o)=>{const r=t.buffer,a=null===r?i:Math.min(r.duration,i);null!==r&&a>r.duration-.5/t.context.sampleRate?e.call(t,s,0,0):e.call(t,s,a,o)})},St=(t,e)=>{const s=e.createGain();t.connect(s);const i=(o=t.disconnect,()=>{o.call(t,s),t.removeEventListener("ended",i)});var o;t.addEventListener("ended",i),u(t,s),t.stop=(e=>{let i=!1;return(o=0)=>{if(i)try{e.call(t,o)}catch{s.gain.setValueAtTime(0,o)}else e.call(t,o),i=!0}})(t.stop)};class vt extends l{constructor(t){super(t),this.onended=p,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new d({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(l.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:p})}_startGain(t,e=1){_(-1===this._startTime,"Source cannot be started more than once");const s=this.toSeconds(this._fadeIn);return this._startTime=t+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+s):this._gainNode.gain.exponentialApproachValueAtTime(e,t,s)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){_(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.now()),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==p&&(this.onended(this),this.onended=p,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),_(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=p,this}}class xt extends l{constructor(t){super(t),this.input=void 0,this._state=new f("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=p,this._syncedStop=p,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new G({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,y(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(l.getDefaults(),{mute:!1,onstop:p,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,s){let i=m(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(i=this._clampToCurrentTime(i),this._synced||"started"!==this._state.getValueAtTime(i))if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const t=this._state.get(i);t&&(t.offset=this.toSeconds(S(e,0)),t.duration=s?this.toSeconds(s):void 0);const o=this.context.transport.schedule((t=>{this._start(t,e,s)}),i);this._scheduled.push(o),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else v(this.context),this._start(i,e,s);else _(g(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,e,s);return this}stop(t){let e=m(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||x(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,s){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(g(e,0)){const s=this._state.get(e);if(s&&"started"===s.state&&s.time!==e){const i=e-this.toSeconds(s.time);let o;s.duration&&(o=this.toSeconds(s.duration)-i),this._start(t,this.toSeconds(s.offset)+i,o)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((t=>this.context.transport.clear(t))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=p,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class bt extends vt{constructor(){super(b(bt.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=b(bt.getDefaults(),arguments,["url","onload"]);T(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new w({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new q(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(vt.getDefaults(),{url:new q,loop:!1,loopEnd:0,loopStart:0,onload:p,onerror:p,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,s,i=1){_(this.buffer.loaded,"buffer is either not set or not loaded");const o=this.toSeconds(t);this._startGain(o,i),e=this.loop?S(e,this.loopStart):S(e,0);let r=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),s=t-e;O(r,t)&&(r=(r-e)%s+e),C(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,E(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(o,r)),x(s)){let t=this.toSeconds(s);t=Math.max(t,0),this.stop(o+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function Tt(t,e){return B(this,void 0,void 0,(function*(){const s=e/t.context.sampleRate,i=new N(1,s,t.context.sampleRate);new t.constructor(Object.assign(t.get(),{frequency:2/s,detune:0,context:i})).toDestination().start(0);return(yield i.render()).getChannelData(0)}))}class wt extends vt{constructor(){super(b(wt.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=b(wt.getDefaults(),arguments,["frequency","type"]);T(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new w({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new w({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),y(this,["frequency","detune"])}static getDefaults(){return Object.assign(vt.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class qt extends xt{constructor(){super(b(qt.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=b(qt.getDefaults(),arguments,["frequency","type"]);this.frequency=new V({context:this.context,units:"frequency",value:t.frequency}),y(this,"frequency"),this.detune=new V({context:this.context,units:"cents",value:t.detune}),y(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(xt.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),s=new wt({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return qt._periodicWaveCache.find((t=>t.phase===this._phase&&A(t.partials,this._partials)))}{const t=qt._periodicWaveCache.find((t=>t.type===this._type&&t.phase===this._phase));return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(x(e)){const{partials:t,wave:s}=e;this._wave=s,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,s]=this._getRealImaginary(t,this._phase),i=this.context.createPeriodicWave(e,s);this._wave=i,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),qt._periodicWaveCache.push({imag:s,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),qt._periodicWaveCache.length>100&&qt._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){R(t,0);let e=this._type;const s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(e=s[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach(((t,s)=>e[s]=t)),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let s=2048;const i=new Float32Array(s),o=new Float32Array(s);let r=1;if("custom"===t){if(r=this._partials.length+1,this._partialCount=this._partials.length,s=r,0===this._partials.length)return[i,o]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(r=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],r=Math.max(r,2),s=r):this._partialCount=0,this._partials=[]}for(let a=1;a<s;++a){const s=2/(a*Math.PI);let n;switch(t){case"sine":n=a<=r?1:0,this._partials[a-1]=n;break;case"square":n=1&a?2*s:0,this._partials[a-1]=n;break;case"sawtooth":n=s*(1&a?1:-1),this._partials[a-1]=n;break;case"triangle":n=1&a?s*s*2*(a-1>>1&1?-1:1):0,this._partials[a-1]=n;break;case"custom":n=this._partials[a-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==n?(i[a]=-n*Math.sin(e*a),o[a]=n*Math.cos(e*a)):(i[a]=0,o[a]=0)}return[i,o]}_inverseFFT(t,e,s){let i=0;const o=t.length;for(let r=0;r<o;r++)i+=t[r]*Math.cos(r*s)+e[r]*Math.sin(r*s);return i}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let s=0;const i=2*Math.PI;for(let o=0;o<32;o++)s=Math.max(this._inverseFFT(t,e,o/32*i),s);return k(-this._inverseFFT(t,e,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return B(this,void 0,void 0,(function*(){return Tt(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}qt._periodicWaveCache=[];class Ct extends xt{constructor(){super(b(Ct.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new F({context:this.context}),this._modulationNode=new d({context:this.context});const t=b(Ct.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new qt({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new qt({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new P({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),y(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(qt.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return B(this,void 0,void 0,(function*(){return Tt(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Et extends xt{constructor(){super(b(Et.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new d({context:this.context,gain:0});const t=b(Et.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new qt({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new V({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new qt({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new P({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new P({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),y(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(qt.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return B(this,void 0,void 0,(function*(){return Tt(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Ot extends xt{constructor(){super(b(Ot.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new d({context:this.context,gain:0}),this._thresh=new W({context:this.context,mapping:t=>t<=0?-1:1});const t=b(Ot.getDefaults(),arguments,["frequency","width"]);this.width=new V({context:this.context,units:"audioRange",value:t.width}),this._triangle=new qt({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),y(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(xt.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return B(this,void 0,void 0,(function*(){return Tt(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Nt extends xt{constructor(){super(b(Nt.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=b(Nt.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new V({context:this.context,units:"frequency",value:t.frequency}),this.detune=new V({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,y(this,["frequency","detune"])}static getDefaults(){return Object.assign(qt.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach((e=>e.start(t)))}_stop(t){t=this.toSeconds(t),this._forEach((e=>e.stop(t)))}_restart(t){this._forEach((e=>e.restart(t)))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach((e=>e.type=t))}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,s=t/(this._oscillators.length-1);this._forEach(((t,i)=>t.detune.value=e+s*i))}}get count(){return this._oscillators.length}set count(t){if(R(t,1),this._oscillators.length!==t){this._forEach((t=>t.dispose())),this._oscillators=[];for(let e=0;e<t;e++){const s=new qt({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):p});"custom"===this.type&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[e]=s}this.spread=this._spread,"started"===this.state&&this._forEach((t=>t.start()))}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(((t,e)=>t.phase=this._phase+e/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach((e=>e.baseType=t)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach((e=>e.partials=t)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach((e=>e.partialCount=t)),this._type=this._oscillators[0].type}asArray(t=1024){return B(this,void 0,void 0,(function*(){return Tt(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((t=>t.dispose())),this}}class At extends xt{constructor(){super(b(At.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new P({context:this.context,value:2});const t=b(At.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Ot({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new qt({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),y(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(xt.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return B(this,void 0,void 0,(function*(){return Tt(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Rt={am:Ct,fat:Nt,fm:Et,oscillator:qt,pulse:Ot,pwm:At};class kt extends xt{constructor(){super(b(kt.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=b(kt.getDefaults(),arguments,["frequency","type"]);this.frequency=new V({context:this.context,units:"frequency",value:t.frequency}),this.detune=new V({context:this.context,units:"cents",value:t.detune}),y(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(qt.getDefaults(),Et.getDefaults(),Ct.getDefaults(),Nt.getDefaults(),Ot.getDefaults(),At.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some((t=>this._sourceType===t))&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=Rt[t],s=this.now();if(this._oscillator){const t=this._oscillator;t.stop(s),this.context.setTimeout((()=>t.dispose()),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof Rt[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&D(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&D(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&M(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return B(this,void 0,void 0,(function*(){return Tt(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class Dt extends xt{constructor(){super(b(Dt.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=b(Dt.getDefaults(),arguments,["url","onload"]);this._buffer=new q({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(xt.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:p,onerror:p,playbackRate:1,reverse:!1})}load(t){return B(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=p){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,s){return super.start(t,e,s),this}_start(t,e,s){e=this._loop?S(e,this._loopStart):S(e,0);const i=this.toSeconds(e),o=s;s=S(s,Math.max(this._buffer.duration-i,0));let r=this.toSeconds(s);r/=this._playbackRate,t=this.toSeconds(t);const a=new bt({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+r),this._state.setStateAtTime("stopped",t+r,{implicitEnd:!0})),this._activeSources.add(a),this._loop&&m(o)?a.start(t,i):a.start(t,i,r-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach((t=>t.stop(e)))}restart(t,e,s){return super.restart(t,e,s),this}_restart(t,e,s){var i;null===(i=[...this._activeSources].pop())||void 0===i||i.stop(t),this._start(t,e,s)}seek(t,e){const s=this.toSeconds(e);if("started"===this._state.getValueAtTime(s)){const e=this.toSeconds(t);this._stop(s),this._start(s,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&R(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopStart=t}))}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&R(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopEnd=t}))}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach((e=>{e.loop=t})),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),s=this._state.getNextState("stopped",e);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach((t=>t.cancelStop()))),this._activeSources.forEach((s=>{s.playbackRate.setValueAtTime(t,e)}))}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((t=>t.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}j([I(0)],Dt.prototype,"fadeIn",void 0),j([I(0)],Dt.prototype,"fadeOut",void 0);export{nt as A,Q as B,X as C,vt as D,kt as O,xt as S,bt as T,H as a,ot as b,tt as c,et as d,st as e,ht as f,ct as g,rt as h,$ as i,U as j,at as k,K as l,ut as m,St as n,lt as o,gt as p,yt as q,ft as r,_t as s,mt as t,dt as u,pt as v,it as w,Z as x,Y as y,z};
