import{i as e,_ as n,j as t,o as r,p as o,q as i}from"./vendor-tone-esm.8edb30e2.js";import{r as a}from"./vendor-react-core.73efc664.js";import{an as s,ai as u,ao as c,M as l,ap as f}from"./vendor-tone-util.a79eb63f.js";import{c as m}from"./vendor-tone-classnames.ea5eadd4.js";import{C as v,c as d}from"./vendor-tone-es.9387ac1c.js";function p(t){var r=t.prefixCls,o=t.visible,i=t.zIndex,u=t.mask,c=t.maskMotion,l=t.maskAnimation,f=t.maskTransitionName;if(!u)return null;var d={};return(c||f||l)&&(d=e({motionAppear:!0},s({motion:c,prefixCls:r,transitionName:f,animation:l}))),a.createElement(v,n({},d,{visible:o,removeOnLeave:!0}),(function(e){var n=e.className;return a.createElement("div",{style:{zIndex:i},className:m("".concat(r,"-mask"),n)})}))}var h=["measure","alignPre","align",null,"motion"];var g=a.forwardRef((function(i,f){var p=i.visible,g=i.prefixCls,E=i.className,b=i.style,N=i.children,x=i.zIndex,C=i.stretch,w=i.destroyPopupOnHide,R=i.forceRender,y=i.align,M=i.point,k=i.getRootDomNode,A=i.getClassNameFromAlign,I=i.onAlign,P=i.onMouseEnter,O=i.onMouseLeave,S=i.onMouseDown,z=i.onTouchStart,j=i.onClick,H=a.useRef(),L=a.useRef(),W=a.useState(),D=t(W,2),T=D[0],F=D[1],q=function(e){var n=a.useState({width:0,height:0}),r=t(n,2),o=r[0],i=r[1];return[a.useMemo((function(){var n={};if(e){var t=o.width,r=o.height;-1!==e.indexOf("height")&&r?n.height=r:-1!==e.indexOf("minHeight")&&r&&(n.minHeight=r),-1!==e.indexOf("width")&&t?n.width=t:-1!==e.indexOf("minWidth")&&t&&(n.minWidth=t)}return n}),[e,o]),function(e){var n=e.offsetWidth,t=e.offsetHeight,r=e.getBoundingClientRect(),o=r.width,a=r.height;Math.abs(n-o)<1&&Math.abs(t-a)<1&&(n=o,t=a),i({width:n,height:t})}]}(C),B=t(q,2),U=B[0],_=B[1];var G=function(e,n){var i=u(null),s=t(i,2),l=s[0],f=s[1],m=a.useRef();function v(e){f(e,!0)}function d(){c.cancel(m.current)}return a.useEffect((function(){v("measure")}),[e]),a.useEffect((function(){"measure"===l&&n(),l&&(m.current=c(r(o().mark((function e(){var n,t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=h.indexOf(l),(t=h[n+1])&&-1!==n&&v(t);case 3:case"end":return e.stop()}}),e)})))))}),[l]),a.useEffect((function(){return function(){d()}}),[]),[l,function(e){d(),m.current=c((function(){v((function(e){switch(l){case"align":return"motion";case"motion":return"stable"}return e})),null==e||e()}))}]}(p,(function(){C&&_(k())})),J=t(G,2),K=J[0],Q=J[1],V=a.useState(0),X=t(V,2),Y=X[0],Z=X[1],$=a.useRef();function ee(){var e;null===(e=H.current)||void 0===e||e.forceAlign()}function ne(e,n){var t=A(n);T!==t&&F(t),Z((function(e){return e+1})),"align"===K&&(null==I||I(e,n))}l((function(){"alignPre"===K&&Z(0)}),[K]),l((function(){"align"===K&&(Y<3?ee():Q((function(){var e;null===(e=$.current)||void 0===e||e.call($)})))}),[Y]);var te=e({},s(i));function re(){return new Promise((function(e){$.current=e}))}["onAppearEnd","onEnterEnd","onLeaveEnd"].forEach((function(e){var n=te[e];te[e]=function(e,t){return Q(),null==n?void 0:n(e,t)}})),a.useEffect((function(){te.motionName||"motion"!==K||Q()}),[te.motionName,K]),a.useImperativeHandle(f,(function(){return{forceAlign:ee,getElement:function(){return L.current}}}));var oe=e(e({},U),{},{zIndex:x,opacity:"motion"!==K&&"stable"!==K&&p?0:void 0,pointerEvents:p||"stable"===K?void 0:"none"},b),ie=!0;null==y||!y.points||"align"!==K&&"stable"!==K||(ie=!1);var ae=N;return a.Children.count(N)>1&&(ae=a.createElement("div",{className:"".concat(g,"-content")},N)),a.createElement(v,n({visible:p,ref:L,leavedClassName:"".concat(g,"-hidden")},te,{onAppearPrepare:re,onEnterPrepare:re,removeOnLeave:w,forceRender:R}),(function(n,t){var r=n.className,o=n.style,i=m(g,E,T,r);return a.createElement(d,{target:M||k,key:"popup",ref:H,monitorWindowResize:!0,disabled:ie,align:y,onAlign:ne},a.createElement("div",{ref:t,className:i,onMouseEnter:P,onMouseLeave:O,onMouseDownCapture:S,onTouchStartCapture:z,onClick:j,style:e(e({},o),oe)},ae))}))}));g.displayName="PopupInner";var E=a.forwardRef((function(t,r){var o=t.prefixCls,i=t.visible,s=t.zIndex,u=t.children,c=t.mobile,l=(c=void 0===c?{}:c).popupClassName,f=c.popupStyle,d=c.popupMotion,p=void 0===d?{}:d,h=c.popupRender,g=t.onClick,E=a.useRef();a.useImperativeHandle(r,(function(){return{forceAlign:function(){},getElement:function(){return E.current}}}));var b=e({zIndex:s},f),N=u;return a.Children.count(u)>1&&(N=a.createElement("div",{className:"".concat(o,"-content")},u)),h&&(N=h(N)),a.createElement(v,n({visible:i,ref:E,removeOnLeave:!0},p),(function(n,t){var r=n.className,i=n.style,s=m(o,l,r);return a.createElement("div",{ref:t,className:s,onClick:g,style:e(e({},i),b)},N)}))}));E.displayName="MobilePopupInner";var b=["visible","mobile"],N=a.forwardRef((function(r,o){var s=r.visible,u=r.mobile,c=i(r,b),l=a.useState(s),m=t(l,2),v=m[0],d=m[1],h=a.useState(!1),N=t(h,2),x=N[0],C=N[1],w=e(e({},c),{},{visible:v});a.useEffect((function(){d(s),s&&u&&C(f())}),[s,u]);var R=x?a.createElement(E,n({},w,{mobile:u,ref:o})):a.createElement(g,n({},w,{ref:o}));return a.createElement("div",null,a.createElement(p,w),R)}));N.displayName="Popup";export{N as P};
