import{r as e,j as o}from"./vendor-react-core.73efc664.js";import{T as t,c as r}from"./vendor-tone-esm.8edb30e2.js";import{f as n,h as s}from"./app-utils.cd93f9c5.js";import"./app-core.4fc76094.js";import{C as i}from"./vendor-mui-card.3348f8fd.js";import{A as a,C as d,T as l,b as p,c as m,D as c,S as u,d as j}from"./vendor-mui-core.4359195f.js";import{B as v,G as h}from"./vendor-mui-layout.b03fb29f.js";import{I as x}from"./vendor-mui-buttons.74e6c144.js";import{P as y,a as f,S as g,b}from"./vendor-mui-icons-other.bc15c9b6.js";import{F as k,a as P,I as w}from"./vendor-mui-inputs.b77362ac.js";import{M as S}from"./vendor-mui-menus.328affd2.js";import{P as C,S as D}from"./vendor-tone-instruments.3eb491c0.js";import{g as F,F as _,s as I}from"./vendor-tone-core-base.398f9a2a.js";import{A as M}from"./vendor-tone-components.680c7d7e.js";import{S as R}from"./vendor-tone-events.9afa7530.js";import"./vendor-tone-classnames.ea5eadd4.js";import"./vendor-tone-dist.6485732f.js";import"./vendor-tone-module.5bbe5778.js";import"./vendor-tone-util.a79eb63f.js";import"./vendor-tone-helpers.07e4d08d.js";import"./vendor-tone-platform.4f06f964.js";import"./vendor-tone-browser.dd42b0e8.js";import"./vendor-tone-classes.909fbaba.js";import"./vendor-tone-cancel.b93f499f.js";import"./vendor-tone-env.26551821.js";import"./vendor-tone-type.9e20d569.js";import"./vendor-react-dom.e7130502.js";import"./vendor-react-scheduler.c51d43b5.js";import"./vendor-tone-lodash.1d9c6a83.js";import"./vendor-tone-Selector.7ca3b0ed.js";import"./vendor-tone-es.9387ac1c.js";import"./vendor-tone-dist-web.442e5e08.js";import"./vendor-tone-hooks.ee856eec.js";import"./vendor-tone-message.06244fbe.js";import"./vendor-tone-icons.388eb8da.js";import"./vendor-tone-asn.f94d41fd.js";import"./vendor-tone-config-provider.2fc53c46.js";import"./vendor-tone-form.6dd4e248.js";import"./vendor-tone-grid.9235ce83.js";import"./vendor-tone-context.2287e470.js";import"./vendor-tone-locale-provider.8d53e5b8.js";import"./vendor-tone-modal.4772d80b.js";import"./vendor-tone-button.429dcaea.js";import"./vendor-tone-space.95ee87ca.js";import"./vendor-tone-locale.9bc1cdd3.js";import"./vendor-tone-useModal.b905cda5.js";import"./vendor-tone-tooltip.4e7d946d.js";import"./vendor-tone-FormItem.7dbdfc6f.js";import"./vendor-tone-notification.2961f1bd.js";import"./vendor-tone-empty.6f888680.js";import"./vendor-tone-channel.a150b5c9.js";import"./vendor-tone-menu.86d2dba0.js";import"./vendor-tone-layout.4cbd4c32.js";import"./vendor-tone-SubMenu.1b0c3984.js";import"./vendor-tone-useMediaQuery.95247262.js";import"./vendor-tone-useThemeProps.a5833127.js";import"./vendor-tone-validation.226ee14c.js";import"./vendor-tone-LocalizationProvider.b505657c.js";import"./vendor-tone-locales.e8ab67da.js";import"./vendor-tone-TimePanel.ca272323.js";import"./vendor-tone-panels.35d19878.js";import"./vendor-tone-DatetimePanel.eb5b0baf.js";import"./vendor-tone-DatePanel.9f66ebd0.js";import"./vendor-tone-WeekPanel.896778be.js";import"./vendor-tone-MonthPanel.70b7688e.js";import"./vendor-tone-QuarterPanel.144363f0.js";import"./vendor-tone-YearPanel.b92617d1.js";import"./vendor-tone-DecadePanel.8c0dc02f.js";import"./vendor-tone-TabPanelList.10481429.js";import"./vendor-tone-TabNavList.2513addc.js";import"./vendor-tone-Dialog.2ffc21c8.js";import"./vendor-tone-Content.9808c346.js";import"./vendor-tone-Popup.9ff27a32.js";import"./vendor-tone-SingleObserver.ddf11abe.js";import"./vendor-react-props.65efe0a6.js";import"./vendor-emotion-core.fcf170e6.js";import"./vendor-tone-src.89c6b4f5.js";import"./vendor-tone-styled-engine.72d9b7d5.js";import"./vendor-emotion-styled.ae0fdb08.js";import"./vendor-tone-StyledEngineProvider.626b917c.js";import"./vendor-tone-GlobalStyles.58bf1e29.js";import"./vendor-tone-createTheme.6c673f08.js";import"./vendor-tone-styleFunctionSx.dbcb4226.js";import"./vendor-tone-audio.70450c41.js";import"./vendor-tone-source.0b4b1ccd.js";import"./vendor-tone-tslib.f5f62bcb.js";import"./vendor-tone-signal.648ab60f.js";import"./vendor-tone-effects.66f8dc4e.js";import"./vendor-tone-lib.58935e90.js";import"./vendor-tone-defaults.617853c7.js";import"./vendor-tone-adapters.ec1cb8a7.js";import"./app-constants.4a812be2.js";import"./app-modals.11788519.js";import"./app-other-components.5e297c7e.js";import"./vendor-react-redux.ca23f922.js";import"./vendor-tone-shim.e999ecad.js";import"./vendor-tone-cjs.5d603e0b.js";import"./vendor-tone-use-sync-external-store-shim.d3746bbc.js";import"./app-redux-scene-thunks.d96f7130.js";import"./vendor-redux-toolkit.fa18e013.js";import"./vendor-redux-core.f9606c35.js";import"./app-services-api.399edcf9.js";import"./app-services-other.47edd63d.js";import"./app-redux-scene-slice.81f21730.js";import"./vendor-react-router.6468192e.js";import"./app-contexts.6347d155.js";import"./app-redux-other-slices.a7022ed8.js";import"./app-redux-auth-thunks.3612091e.js";import"./app-redux-auth-slice.749a10ad.js";import"./app-redux-note-slice.2ed79aa2.js";import"./app-redux-note-thunks.e47bcfeb.js";import"./vendor-mui-dialogs.59185291.js";import"./app-redux-character-slice.77cb9e4b.js";import"./app-redux-character-thunks.c46623e8.js";import"./app-characters-components.a508a592.js";import"./vendor-tone-select.c6c7620f.js";import"./vendor-tone-spin.d13f75fd.js";import"./vendor-tone-avatar.122bfb6a.js";import"./vendor-tone-popover.9c9808a5.js";import"./app-redux-physics-thunks.c58b7b1a.js";import"./vendor-tone-upload.27f9a3b5.js";import"./vendor-tone-UploadList.9372bedd.js";import"./vendor-tone-progress.cc741b51.js";import"./vendor-tone-card.8385b307.js";import"./vendor-tone-skeleton.45affeec.js";import"./vendor-tone-tabs.69cd71fe.js";import"./vendor-tone-switch.4218e0a6.js";import"./app-scenes-components.e3ba29e5.js";import"./app-scenes-form.07f7a30a.js";import"./vendor-tone-dayjs.54e2289e.js";import"./vendor-tone-alert.89362924.js";import"./vendor-tone-input.876080ec.js";import"./vendor-tone-divider.a6c32c3c.js";import"./vendor-tone-date-picker.3f71bbe3.js";import"./vendor-tone-tag.30f4ea2f.js";import"./vendor-tone-generate.3bd3dbc2.js";import"./vendor-tone-generatePicker.e957b148.js";import"./vendor-tone-radio.0de19148.js";import"./vendor-tone-typography.2404bb54.js";import"./vendor-tone-Base.81f829aa.js";import"./vendor-tone-copy-to-clipboard.e7f533f2.js";import"./vendor-tone-toggle-selection.c563a038.js";import"./app-physics-components.dcafff4c.js";import"./app-physics-list.9dc0d346.js";import"./app-redux-physics-slice.b0d37703.js";import"./vendor-tone-input-number.28372503.js";import"./vendor-mui-list.1c6188a6.js";import"./vendor-tone-system.c96386b3.js";import"./vendor-tone-DatePicker.de25fe8c.js";import"./vendor-tone-DesktopDatePicker.f7be1484.js";import"./vendor-tone-dateViewRenderers.da97565f.js";import"./vendor-tone-DateCalendar.07d8b1f1.js";import"./vendor-tone-RtlProvider.df0b182e.js";import"./vendor-tone-PickersDay.36f5e5b8.js";import"./vendor-tone-constants.d67dcaf6.js";import"./vendor-tone-PickersCalendarHeader.d19a4873.js";import"./vendor-tone-YearCalendar.53b1f79c.js";import"./vendor-tone-MonthCalendar.110ab177.js";import"./vendor-tone-DateField.a7ba308d.js";import"./vendor-tone-useField.40869926.js";import"./vendor-tone-PickersTextField.1b1b2159.js";import"./vendor-tone-PickersInput.177ec5f5.js";import"./vendor-tone-PickersInputBase.b4cbf25e.js";import"./vendor-tone-PickersSectionList.b3696c3f.js";import"./vendor-tone-PickersFilledInput.ea55e758.js";import"./vendor-tone-PickersOutlinedInput.cd7d73be.js";import"./vendor-tone-useDesktopPicker.83b3e221.js";import"./vendor-tone-usePicker.425377a1.js";import"./vendor-tone-PickersLayout.80c91798.js";import"./vendor-tone-PickersActionBar.6bdc4ff9.js";import"./vendor-tone-PickersShortcuts.51e2ec2a.js";import"./vendor-tone-MobileDatePicker.51f93f0c.js";import"./vendor-tone-useMobilePicker.b0b52352.js";import"./app-redux-core.93965072.js";import"./vendor-redux-persist.1ece7284.js";import"./app-routes.fd68d670.js";import"./vendor-tone-Stack.f8b60d0c.js";import"./vendor-tone-DefaultPropsProvider.3d25d93b.js";import"./vendor-tone-Container.5ed3ed7d.js";const z=({universeId:z,initialMusic:A=null,onMusicGenerated:L=null,mode:T="standard"})=>{const[B,E]=e.useState(!1),[N,$]=e.useState(!1),[G,O]=e.useState(A),[W,q]=e.useState(75),[J,V]=e.useState(null),[Q,U]=e.useState(!1),[H,Y]=e.useState(!1),[K,X]=e.useState(!1),[Z,ee]=e.useState("default"),[oe,te]=e.useState(!1),[re,ne]=e.useState({tempo:120,scale_type:"major",root_note:"C",melody_complexity:.5}),[se,ie]=e.useState("2D");e.useState(!1);const[ae,de]=e.useState(null),le=e.useRef(null),pe=e.useRef(null),me=e.useRef(null),ce=e.useRef(null),ue=e.useRef(null),je=e.useRef(null),ve=async()=>{try{return"running"!==r.state&&(await I(),te(!0)),le.current=new C(D).toDestination(),le.current.volume.value=F(W/100),ue.current=new M("waveform",128),le.current.connect(ue.current),!0}catch(e){return V("Failed to initialize audio. Please try again."),!1}};e.useEffect((()=>(le.current=new C(D).toDestination(),le.current.volume.value=F(W/100),ue.current=new M("waveform",128),le.current.connect(ue.current),()=>{pe.current&&pe.current.dispose(),le.current&&le.current.dispose(),ue.current&&ue.current.dispose(),je.current&&cancelAnimationFrame(je.current)})),[]),e.useEffect((()=>{le.current&&(le.current.volume.value=F(W/100))}),[W]),e.useEffect((()=>{const e=ce.current;if(!e||!ue.current)return;const o=n(e);me.current=o;const t=()=>{if(B&&ue.current){const o=ue.current.getValue();s(e,o,me.current,G)}je.current=requestAnimationFrame(t)};return t(),()=>{je.current&&cancelAnimationFrame(je.current)}}),[B,G]);const he=async(e=null)=>{var o,t;await ve();try{$(!0),V(null),de(null),B&&await fe();const o=e||(H?re:null);let t="";if(o&&H&&(t=`?custom_params=${encodeURIComponent(JSON.stringify(o))}`),K){t+=`${t?"&":"?"}ai_style=${Z}`}const r=`/api/universes/${z}/generate-music${t}`,n=await fetch(r),s=await n.json();s.music_data?(O(s.music_data),de("Music generated successfully"),L&&L(s.music_data),await ye(s.music_data),await fe(!0)):s.error?V(s.error):V("No music data received from the server")}catch(r){V((null==(t=null==(o=r.response)?void 0:o.data)?void 0:t.error)||r.message||"Failed to generate music. Please try again.")}finally{$(!1)}},xe=async()=>{var e,o;if(G)try{U(!0),V(null);const e=await fetch(`/api/universes/${z}/download-music`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({music_data:G,format:"mp3"})}),o=await e.json(),t=o.download_url;if(t){const e=document.createElement("a");e.href=t,e.download=`harmonic_universe_${z}_${Date.now()}.mp3`,document.body.appendChild(e),e.click(),document.body.removeChild(e),de("Music downloaded successfully")}else o.error?V(o.error):V("No download URL received from the server")}catch(t){V((null==(o=null==(e=t.response)?void 0:e.data)?void 0:o.error)||t.message||"Failed to download music. Please try again.")}finally{U(!1)}else V("No music data available to download")},ye=e=>{if(e&&e.melody&&e.melody.length)try{pe.current&&pe.current.dispose(),oe||ve();const o=e.tempo||120;t.bpm.value=o;const r=e.melody;return pe.current=new R(((e,o)=>{le.current.triggerAttackRelease(_(o.note,"midi").toFrequency(),o.duration,e,o.velocity)}),r.map((e=>({note:e.note,duration:e.duration,velocity:e.velocity||.7}))),"8n"),"started"!==t.state&&t.start(),pe.current.loop=!0,!0}catch(o){return V("Failed to create music sequence"),!1}else V("Invalid music data")},fe=async(e=null)=>{if(!oe){if(!(await ve()))return}const o=null!==e?e:!B;try{if(o){if(!G)return void(await he());!pe.current&&G&&ye(G),pe.current&&pe.current.start(0)}else pe.current&&pe.current.stop();E(o)}catch(t){V("Failed to toggle playback")}},ge=(e,o)=>{ne((t=>({...t,[e]:o})))};return o.jsxs(i,{sx:{width:"100%",maxWidth:800,mx:"auto"},children:[J&&o.jsx(a,{severity:"error",sx:{m:2},children:J}),ae&&o.jsx(a,{severity:"success",sx:{m:2},children:ae}),N&&o.jsx(v,{sx:{display:"flex",justifyContent:"center",p:3},children:o.jsx(d,{})}),o.jsxs(v,{sx:{width:"100%",height:200,bgcolor:"rgba(0, 0, 0, 0.05)",borderRadius:1,overflow:"hidden",position:"relative",mb:2},children:[o.jsx("canvas",{ref:ce,width:800,height:200,style:{width:"100%",height:"100%",display:"2D"===se?"block":"none"}}),"3D"===se&&o.jsx(v,{sx:{width:"100%",height:"100%",position:"absolute",top:0},children:o.jsx(l,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"text.secondary"},children:"3D Visualization"})})]}),o.jsxs(p,{spacing:2,sx:{p:2},children:[o.jsxs(v,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:2},children:[o.jsx(x,{color:"primary",onClick:()=>fe(),disabled:N,size:"large",children:B?o.jsx(y,{}):o.jsx(f,{})}),o.jsx(x,{color:"primary",onClick:he,disabled:N,size:"large",children:o.jsx(g,{})}),o.jsx(x,{color:"primary",onClick:xe,disabled:N||Q||!G,size:"large",children:o.jsx(b,{})})]}),o.jsxs(v,{sx:{px:3},children:[o.jsx(l,{id:"volume-slider",gutterBottom:!0,children:"Volume"}),o.jsx(m,{value:W,onChange:(e,o)=>q(o),"aria-labelledby":"volume-slider",valueLabelDisplay:"auto",min:0,max:100})]}),"standard"===T&&o.jsxs(o.Fragment,{children:[o.jsx(c,{}),o.jsxs(v,{children:[o.jsx(k,{control:o.jsx(u,{checked:H,onChange:e=>Y(e.target.checked)}),label:"Customization"}),H&&o.jsx(v,{sx:{mt:2,mx:2},children:o.jsxs(h,{container:!0,spacing:2,children:[o.jsxs(h,{item:!0,xs:12,sm:6,children:[o.jsx(l,{gutterBottom:!0,children:"Tempo"}),o.jsx(m,{value:re.tempo,onChange:(e,o)=>ge("tempo",o),min:60,max:180,valueLabelDisplay:"auto"})]}),o.jsxs(h,{item:!0,xs:12,sm:6,children:[o.jsx(l,{gutterBottom:!0,children:"Complexity"}),o.jsx(m,{value:re.melody_complexity,onChange:(e,o)=>ge("melody_complexity",o),min:0,max:1,step:.1,valueLabelDisplay:"auto"})]}),o.jsx(h,{item:!0,xs:12,sm:6,children:o.jsxs(P,{fullWidth:!0,children:[o.jsx(w,{id:"scale-type-label",children:"Scale"}),o.jsxs(j,{labelId:"scale-type-label",value:re.scale_type,label:"Scale",onChange:e=>ge("scale_type",e.target.value),children:[o.jsx(S,{value:"major",children:"Major"}),o.jsx(S,{value:"minor",children:"Minor"}),o.jsx(S,{value:"pentatonic",children:"Pentatonic"}),o.jsx(S,{value:"blues",children:"Blues"}),o.jsx(S,{value:"chromatic",children:"Chromatic"})]})]})}),o.jsx(h,{item:!0,xs:12,sm:6,children:o.jsxs(P,{fullWidth:!0,children:[o.jsx(w,{id:"root-note-label",children:"Root Note"}),o.jsx(j,{labelId:"root-note-label",value:re.root_note,label:"Root Note",onChange:e=>ge("root_note",e.target.value),children:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].map((e=>o.jsx(S,{value:e,children:e},e)))})]})})]})})]}),o.jsxs(v,{children:[o.jsx(k,{control:o.jsx(u,{checked:K,onChange:e=>X(e.target.checked)}),label:"AI Style"}),K&&o.jsx(v,{sx:{mt:2,mx:2},children:o.jsxs(P,{fullWidth:!0,children:[o.jsx(w,{id:"ai-style-label",children:"Style"}),o.jsxs(j,{labelId:"ai-style-label",value:Z,label:"Style",onChange:e=>ee(e.target.value),children:[o.jsx(S,{value:"default",children:"Default"}),o.jsx(S,{value:"epic",children:"Epic"}),o.jsx(S,{value:"ambient",children:"Ambient"}),o.jsx(S,{value:"jazz",children:"Jazz"}),o.jsx(S,{value:"classical",children:"Classical"}),o.jsx(S,{value:"electronic",children:"Electronic"})]})]})})]})]})]})]})};export{z as default};
