var e=Object.defineProperty,t=(t,r,o)=>(((t,r,o)=>{r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o})(t,"symbol"!=typeof r?r+"":r,o),o);import{r,j as o}from"./vendor-react-core.73efc664.js";import"./vendor-tone-classnames.ea5eadd4.js";import"./vendor-mui-core.4359195f.js";import"./vendor-tone-useThemeProps.a5833127.js";import"./vendor-tone-util.a79eb63f.js";import"./vendor-tone-helpers.07e4d08d.js";import"./vendor-tone-platform.4f06f964.js";import"./vendor-tone-browser.dd42b0e8.js";import"./vendor-tone-classes.909fbaba.js";import"./vendor-tone-core-base.398f9a2a.js";import"./vendor-tone-defaults.617853c7.js";import"./vendor-tone-cancel.b93f499f.js";import"./vendor-tone-adapters.ec1cb8a7.js";import"./vendor-tone-lodash.1d9c6a83.js";import"./vendor-tone-events.9afa7530.js";import"./vendor-tone-audio.70450c41.js";import"./vendor-tone-source.0b4b1ccd.js";import"./vendor-tone-tslib.f5f62bcb.js";import"./vendor-tone-signal.648ab60f.js";import"./vendor-tone-components.680c7d7e.js";import"./vendor-tone-esm.8edb30e2.js";import"./vendor-tone-type.9e20d569.js";import"./vendor-tone-dist.6485732f.js";import"./vendor-tone-module.5bbe5778.js";import"./vendor-tone-styled-engine.72d9b7d5.js";import"./vendor-emotion-styled.ae0fdb08.js";import"./vendor-emotion-core.fcf170e6.js";import"./vendor-tone-src.89c6b4f5.js";import"./vendor-tone-StyledEngineProvider.626b917c.js";import"./vendor-tone-GlobalStyles.58bf1e29.js";import"./vendor-tone-createTheme.6c673f08.js";import"./vendor-tone-styleFunctionSx.dbcb4226.js";import"./vendor-tone-instruments.3eb491c0.js";import"./vendor-tone-effects.66f8dc4e.js";import"./vendor-react-dom.e7130502.js";import"./vendor-react-scheduler.c51d43b5.js";import"./vendor-tone-hooks.ee856eec.js";import"./vendor-tone-es.9387ac1c.js";import"./vendor-tone-dist-web.442e5e08.js";import"./vendor-tone-Selector.7ca3b0ed.js";import"./vendor-tone-TimePanel.ca272323.js";import"./vendor-tone-panels.35d19878.js";import"./vendor-tone-DatetimePanel.eb5b0baf.js";import"./vendor-tone-DatePanel.9f66ebd0.js";import"./vendor-tone-WeekPanel.896778be.js";import"./vendor-tone-MonthPanel.70b7688e.js";import"./vendor-tone-QuarterPanel.144363f0.js";import"./vendor-tone-YearPanel.b92617d1.js";import"./vendor-tone-DecadePanel.8c0dc02f.js";import"./vendor-tone-TabPanelList.10481429.js";import"./vendor-tone-TabNavList.2513addc.js";import"./vendor-tone-Dialog.2ffc21c8.js";import"./vendor-tone-Content.9808c346.js";import"./vendor-tone-context.2287e470.js";import"./vendor-tone-SubMenu.1b0c3984.js";import"./vendor-tone-Popup.9ff27a32.js";import"./vendor-tone-SingleObserver.ddf11abe.js";import"./vendor-tone-icons.388eb8da.js";import"./vendor-tone-asn.f94d41fd.js";import"./vendor-tone-message.06244fbe.js";import"./vendor-tone-config-provider.2fc53c46.js";import"./vendor-tone-form.6dd4e248.js";import"./vendor-tone-grid.9235ce83.js";import"./vendor-tone-locale-provider.8d53e5b8.js";import"./vendor-tone-modal.4772d80b.js";import"./vendor-tone-button.429dcaea.js";import"./vendor-tone-space.95ee87ca.js";import"./vendor-tone-locale.9bc1cdd3.js";import"./vendor-tone-useModal.b905cda5.js";import"./vendor-tone-tooltip.4e7d946d.js";import"./vendor-tone-FormItem.7dbdfc6f.js";import"./vendor-tone-notification.2961f1bd.js";import"./vendor-tone-empty.6f888680.js";import"./vendor-tone-channel.a150b5c9.js";import"./vendor-tone-menu.86d2dba0.js";import"./vendor-tone-layout.4cbd4c32.js";import"./vendor-tone-useMediaQuery.95247262.js";import"./vendor-mui-buttons.74e6c144.js";import"./vendor-tone-system.c96386b3.js";import"./vendor-mui-inputs.b77362ac.js";import"./vendor-tone-validation.226ee14c.js";import"./vendor-tone-LocalizationProvider.b505657c.js";import"./vendor-tone-locales.e8ab67da.js";import"./vendor-tone-RtlProvider.df0b182e.js";import"./vendor-tone-constants.d67dcaf6.js";import"./vendor-mui-dialogs.59185291.js";import"./vendor-tone-env.26551821.js";import"./vendor-react-props.65efe0a6.js";import"./vendor-mui-list.1c6188a6.js";import"./vendor-tone-Stack.f8b60d0c.js";import"./vendor-mui-menus.328affd2.js";import"./vendor-tone-DefaultPropsProvider.3d25d93b.js";let n;try{n=require("three")}catch(s){n={Scene:class{},PerspectiveCamera:class{constructor(){t(this,"position",{z:5})}},WebGLRenderer:class{constructor(){t(this,"domElement",document.createElement("div"))}setSize(){}render(){}},BoxGeometry:class{},MeshBasicMaterial:class{},Mesh:class{constructor(){t(this,"rotation",{x:0,y:0})}},Color:class{},AmbientLight:class{},DirectionalLight:class{}}}const i=({isPlaying:e,musicData:t,analyzerData:i})=>{const s=r.useRef(null),a=r.useRef(null),c=r.useRef(null),d=r.useRef(null),m=r.useRef(null),l=r.useRef(null),u=r.useRef(null),p=r.useRef(Date.now()),v=r.useRef({energy:.5,mood:"neutral",complexity:.5,style:"default"}),[j,h]=r.useState(void 0!==n&&"function"==typeof n.Scene);r.useEffect((()=>{if(!j||!s.current)return;const e=new n.Scene;a.current=e;const t=new n.PerspectiveCamera(75,s.current.clientWidth/s.current.clientHeight,.1,1e3);t.position.z=30,c.current=t;const r=new n.WebGLRenderer({alpha:!0,antialias:!0});r.setSize(s.current.clientWidth,s.current.clientHeight),r.setClearColor(0,0),s.current.appendChild(r.domElement),d.current=r;const o=new n.AmbientLight(4210752);e.add(o);const i=new n.DirectionalLight(16777215,1);i.position.set(1,1,1),e.add(i),y(),f();const m=()=>{s.current&&c.current&&d.current&&(c.current.aspect=s.current.clientWidth/s.current.clientHeight,c.current.updateProjectionMatrix(),d.current.setSize(s.current.clientWidth,s.current.clientHeight))};return window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m),u.current&&cancelAnimationFrame(u.current),d.current&&s.current&&s.current.removeChild(d.current.domElement)}}),[e,t,j]);const f=()=>{var e;if(!a.current)return;m.current&&a.current.remove(m.current);const r=(null==(e=null==t?void 0:t.melody)?void 0:e.length)?100*t.melody.length:1e3,o=new n.BufferGeometry,i=new Float32Array(3*r),s=new Float32Array(3*r),c=new Float32Array(r),d=20;for(let t=0;t<r;t++){const e=Math.acos(2*t/r-1),o=Math.sqrt(r*Math.PI)*e;i[3*t]=d*Math.sin(e)*Math.cos(o),i[3*t+1]=d*Math.sin(e)*Math.sin(o),i[3*t+2]=d*Math.cos(e),s[3*t]=.5+i[3*t]/d/2,s[3*t+1]=.5+i[3*t+1]/d/2,s[3*t+2]=.5+i[3*t+2]/d/2,c[t]=.5*Math.random()+.5}o.setAttribute("position",new n.BufferAttribute(i,3)),o.setAttribute("color",new n.BufferAttribute(s,3)),o.setAttribute("size",new n.BufferAttribute(c,1));const l=new n.PointsMaterial({size:.5,vertexColors:!0,blending:n.AdditiveBlending,transparent:!0,sizeAttenuation:!0}),u=new n.Points(o,l);a.current.add(u),m.current=u},y=()=>{if(!a.current)return;l.current&&a.current.remove(l.current);const e=2e3,t=new n.BufferGeometry,r=new Float32Array(6e3),o=new Float32Array(e);for(let n=0;n<e;n++){const e=Math.random()*Math.PI*2,t=Math.random()*Math.PI;r[3*n]=80*Math.sin(t)*Math.cos(e),r[3*n+1]=80*Math.sin(t)*Math.sin(e),r[3*n+2]=80*Math.cos(t),o[n]=1.5*Math.random()}t.setAttribute("position",new n.BufferAttribute(r,3)),t.setAttribute("size",new n.BufferAttribute(o,1));const i=new n.ShaderMaterial({uniforms:{color:{value:new n.Color(16777215)},pointTexture:{value:null}},vertexShader:"\n        attribute float size;\n        varying vec3 vColor;\n        void main() {\n          vColor = vec3(1.0, 1.0, 1.0);\n          vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n          gl_PointSize = size * (300.0 / -mvPosition.z);\n          gl_Position = projectionMatrix * mvPosition;\n        }\n      ",fragmentShader:"\n        varying vec3 vColor;\n        void main() {\n          float r = distance(gl_PointCoord, vec2(0.5, 0.5));\n          if (r > 0.5) discard;\n          float intensity = 1.0 - 2.0 * r;\n          gl_FragColor = vec4(vColor, intensity);\n        }\n      ",blending:n.AdditiveBlending,transparent:!0}),s=new n.Points(t,i);a.current.add(s),l.current=s};r.useEffect((()=>{if(!a.current||!c.current||!d.current)return;const t=()=>{u.current=requestAnimationFrame(t),e?m.current&&i&&g(i):M(5e-4),d.current.render(a.current,c.current)};return t(),()=>{u.current&&cancelAnimationFrame(u.current)}}),[e,i]),r.useEffect((()=>{t&&(f(),t.ai_metadata&&(v.current={energy:t.ai_metadata.energy||.5,mood:t.ai_metadata.mood||"neutral",complexity:t.ai_metadata.complexity||.5,style:t.ai_metadata.style||"default"},b(t.ai_metadata.style)))}),[t]);const b=e=>{if(a.current)switch(e){case"ambient":if(m.current){const e=m.current.geometry.attributes.color;for(let t=0;t<e.count;t++)e.setXYZ(t,.2+.2*Math.random(),.3+.2*Math.random(),.5+.3*Math.random());e.needsUpdate=!0}break;case"classical":if(m.current){const e=m.current.geometry.attributes.color;for(let t=0;t<e.count;t++)e.setXYZ(t,.5+.3*Math.random(),.4+.2*Math.random(),.2+.1*Math.random());e.needsUpdate=!0}break;case"electronic":if(m.current){const e=m.current.geometry.attributes.color;for(let t=0;t<e.count;t++){const r=t%3;0===r?e.setXYZ(t,.1,.9,.9):1===r?e.setXYZ(t,.9,.1,.8):e.setXYZ(t,.1,.8,.2)}e.needsUpdate=!0}break;case"jazz":if(m.current){const e=m.current.geometry.attributes.color;for(let t=0;t<e.count;t++){const r=t%4;0===r?e.setXYZ(t,.5,.1,.5):1===r?e.setXYZ(t,.1,.1,.5):2===r?e.setXYZ(t,.5,.4,.1):e.setXYZ(t,.3,.05,.3)}e.needsUpdate=!0}break;default:if(m.current){const e=m.current.geometry.attributes.position,t=m.current.geometry.attributes.color,r=20;for(let o=0;o<e.count;o++){const n=e.getX(o),i=e.getY(o),s=e.getZ(o);t.setXYZ(o,.5+n/r/2,.5+i/r/2,.5+s/r/2)}t.needsUpdate=!0}}},g=e=>{if(!m.current||!t)return;const r=m.current,o=r.geometry.attributes.position.array,n=r.geometry.attributes.size.array,i=n.length,s=e.reduce(((e,t)=>e+Math.abs(t)),0)/e.length,a=(Date.now()-p.current)/1e3,c=t.tempo/60,d=v.current,l=d.energy||.5,u=d.complexity||.5;for(let t=0;t<i;t++){const r=o[3*t],s=o[3*t+1],d=o[3*t+2],m=Math.sqrt(r*r+s*s+d*d),p=.05*Math.sin(a*c*Math.PI)+1,v=Math.floor(t/i*e.length),j=Math.abs(e[v]||0),h=m*(p+.2*j*l)/m;o[3*t]=r*h,o[3*t+1]=s*h,o[3*t+2]=d*h,n[t]=(.5+.5*Math.random()*u)*(1+j+.1*Math.sin(a*c*Math.PI)*l)}r.geometry.attributes.position.needsUpdate=!0,r.geometry.attributes.size.needsUpdate=!0,M(.001+.001*s*l)},M=e=>{m.current&&(m.current.rotation.y+=e,m.current.rotation.x+=.5*e),l.current&&(l.current.rotation.y+=.2*e)};return j?o.jsx("div",{ref:s,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,zIndex:0}}):o.jsx("div",{className:"visualizer-fallback",children:o.jsx("p",{children:"3D visualization not available (Three.js library not loaded)"})})};export{i as default};
