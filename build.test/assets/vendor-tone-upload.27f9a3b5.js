import{j as e,_ as t,k as n,p as r,l as o}from"./vendor-tone-esm.8edb30e2.js";import{r as a}from"./vendor-react-core.73efc664.js";import{_ as c}from"./vendor-tone-type.9e20d569.js";import{c as i}from"./vendor-tone-classnames.ea5eadd4.js";import{a2 as s}from"./vendor-tone-es.9387ac1c.js";import{O as l,c_ as d,c$ as u,d0 as p,d1 as f}from"./vendor-tone-util.a79eb63f.js";import{r as v}from"./vendor-react-dom.e7130502.js";import{D as m}from"./vendor-tone-config-provider.2fc53c46.js";import{L as h}from"./vendor-tone-locale-provider.8d53e5b8.js";import{d as g}from"./vendor-tone-locale.9bc1cdd3.js";import{U as w}from"./vendor-tone-UploadList.9372bedd.js";import{C as y}from"./vendor-tone-context.2287e470.js";var b=globalThis&&globalThis.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function c(e){try{s(r.next(e))}catch(t){a(t)}}function i(e){try{s(r.throw(e))}catch(t){a(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,i)}s((r=r.apply(e,t||[])).next())}))},j="__LIST_IGNORE_".concat(Date.now(),"__"),x=function(x,_){var E=x.fileList,I=x.defaultFileList,O=x.onRemove,R=x.showUploadList,D=void 0===R||R,S=x.listType,P=void 0===S?"text":S,N=x.onPreview,U=x.onDownload,L=x.onChange,C=x.onDrop,F=x.previewFile,T=x.disabled,k=x.locale,A=x.iconRender,B=x.isImageUrl,G=x.progress,M=x.prefixCls,z=x.className,H=x.type,J=void 0===H?"select":H,V=x.children,$=x.style,q=x.itemRender,K=x.maxCount,Q=x.data,W=void 0===Q?{}:Q,X=x.multiple,Y=void 0!==X&&X,Z=x.action,ee=void 0===Z?"":Z,te=x.accept,ne=void 0===te?"":te,re=x.supportServerRender,oe=void 0===re||re,ae=a.useContext(m),ce=null!=T?T:ae,ie=l(I||[],{value:E,postState:function(e){return null!=e?e:[]}}),se=e(ie,2),le=se[0],de=se[1],ue=a.useState("drop"),pe=e(ue,2),fe=pe[0],ve=pe[1],me=a.useRef(null);a.useMemo((function(){var e=Date.now();(E||[]).forEach((function(t,n){t.uid||Object.isFrozen(t)||(t.uid="__AUTO__".concat(e,"_").concat(n,"__"))}))}),[E]);var he=function(e,t,n){var r=o(t);1===K?r=r.slice(-1):K&&(r=r.slice(0,K)),v.flushSync((function(){de(r)}));var a={file:e,fileList:r};n&&(a.event=n),v.flushSync((function(){null==L||L(a)}))},ge=function(e){var t=e.filter((function(e){return!e.file[j]}));if(t.length){var n=t.map((function(e){return d(e.file)})),r=o(le);n.forEach((function(e){r=u(e,r)})),n.forEach((function(e,n){var o=e;if(t[n].parsedFile)e.status="uploading";else{var a,c=e.originFileObj;try{a=new File([c],c.name,{type:c.type})}catch(i){(a=new Blob([c],{type:c.type})).name=c.name,a.lastModifiedDate=new Date,a.lastModified=(new Date).getTime()}a.uid=e.uid,o=a}he(o,r)}))}},we=function(e,t,n){try{"string"==typeof e&&(e=JSON.parse(e))}catch(a){}if(p(t,le)){var r=d(t);r.status="done",r.percent=100,r.response=e,r.xhr=n;var o=u(r,le);he(r,o)}},ye=function(e,t){if(p(t,le)){var n=d(t);n.status="uploading",n.percent=e.percent;var r=u(n,le);he(n,r,e)}},be=function(e,t,n){if(p(n,le)){var r=d(n);r.error=e,r.response=t,r.status="error";var o=u(r,le);he(r,o)}},je=function(e){var n;Promise.resolve("function"==typeof O?O(e):O).then((function(r){var o;if(!1!==r){var a=f(e,le);a&&(n=t(t({},e),{status:"removed"}),null==le||le.forEach((function(e){var t=void 0!==n.uid?"uid":"name";e[t]!==n[t]||Object.isFrozen(e)||(e.status="removed")})),null===(o=me.current)||void 0===o||o.abort(n),he(n,a))}}))},xe=function(e){ve(e.type),"drop"===e.type&&(null==C||C(e))};a.useImperativeHandle(_,(function(){return{onBatchStart:ge,onSuccess:we,onProgress:ye,onError:be,fileList:le,upload:me.current}}));var _e=a.useContext(y),Ee=_e.getPrefixCls,Ie=_e.direction,Oe=Ee("upload",M),Re=t(t({onBatchStart:ge,onError:be,onProgress:ye,onSuccess:we},x),{data:W,multiple:Y,action:ee,accept:ne,supportServerRender:oe,prefixCls:Oe,disabled:ce,beforeUpload:function(e,t){return b(void 0,void 0,void 0,r().mark((function n(){var o,a,i,s;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=x.beforeUpload,a=x.transformFile,i=e,!o){n.next=13;break}return n.next=5,o(e,t);case 5:if(!1!==(s=n.sent)){n.next=8;break}return n.abrupt("return",!1);case 8:if(delete e[j],s!==j){n.next=12;break}return Object.defineProperty(e,j,{value:!0,configurable:!0}),n.abrupt("return",!1);case 12:"object"===c(s)&&s&&(i=s);case 13:if(!a){n.next=17;break}return n.next=16,a(i);case 16:i=n.sent;case 17:return n.abrupt("return",i);case 18:case"end":return n.stop()}}),n)})))},onChange:void 0});delete Re.className,delete Re.style,V&&!ce||delete Re.id;var De=function(e,n){return D?a.createElement(h,{componentName:"Upload",defaultLocale:g.Upload},(function(r){var o="boolean"==typeof D?{}:D,c=o.showRemoveIcon,i=o.showPreviewIcon,s=o.showDownloadIcon,l=o.removeIcon,d=o.previewIcon,u=o.downloadIcon;return a.createElement(w,{prefixCls:Oe,listType:P,items:le,previewFile:F,onPreview:N,onDownload:U,onRemove:je,showRemoveIcon:!ce&&c,showPreviewIcon:i,showDownloadIcon:s,removeIcon:l,previewIcon:d,downloadIcon:u,iconRender:A,locale:t(t({},r),k),isImageUrl:B,progress:G,appendAction:e,appendActionVisible:n,itemRender:q,disabled:ce})})):e};if("drag"===J){var Se=i(Oe,n(n(n(n(n({},"".concat(Oe,"-drag"),!0),"".concat(Oe,"-drag-uploading"),le.some((function(e){return"uploading"===e.status}))),"".concat(Oe,"-drag-hover"),"dragover"===fe),"".concat(Oe,"-disabled"),ce),"".concat(Oe,"-rtl"),"rtl"===Ie),z);return a.createElement("span",null,a.createElement("div",{className:Se,onDrop:xe,onDragOver:xe,onDragLeave:xe,style:$},a.createElement(s,t({},Re,{ref:me,className:"".concat(Oe,"-btn")}),a.createElement("div",{className:"".concat(Oe,"-drag-container")},V))),De())}var Pe,Ne=i(Oe,n(n(n(n({},"".concat(Oe,"-select"),!0),"".concat(Oe,"-select-").concat(P),!0),"".concat(Oe,"-disabled"),ce),"".concat(Oe,"-rtl"),"rtl"===Ie)),Ue=(Pe=V?void 0:{display:"none"},a.createElement("div",{className:Ne,style:Pe},a.createElement(s,t({},Re,{ref:me}))));return"picture-card"===P?a.createElement("span",{className:i("".concat(Oe,"-picture-card-wrapper"),z)},De(Ue,!!V)):a.createElement("span",{className:z},Ue,De())};const _=a.forwardRef(x);var E=globalThis&&globalThis.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};const I=a.forwardRef((function(e,n){var r=e.style,o=e.height,c=E(e,["style","height"]);return a.createElement(_,t({ref:n},c,{type:"drag",style:t(t({},r),{height:o})}))}));var O=_;O.Dragger=I,O.LIST_IGNORE=j;const R=O;export{R as U};
