import{c as e}from"./vendor-redux-toolkit.fa18e013.js";import t from"./app-services-api.399edcf9.js";import{A as a,C as r,D as o}from"./app-utils.cd93f9c5.js";import{a as s,e as c,b as n,u as l}from"./app-redux-auth-slice.749a10ad.js";const u=e=>{var t,a,r,o;return{message:(null==(a=null==(t=e.response)?void 0:t.data)?void 0:a.message)||e.message||"An error occurred",status:null==(r=e.response)?void 0:r.status,data:null==(o=e.response)?void 0:o.data}},i=e("auth/login",(async(e,{dispatch:l,rejectWithValue:i})=>{try{l(s());const r=await t.login(e),o=r.data||r,n=o.user||o,u=o.token||o.access_token,i=o.refresh_token;u&&localStorage.setItem(a.TOKEN_KEY,u),i&&localStorage.setItem(a.REFRESH_TOKEN_KEY,i),n&&localStorage.setItem(a.USER_KEY,JSON.stringify(n));const d={user:n,token:u,refresh_token:i};return l(c(d)),d}catch(d){if(r()){const e=o();return localStorage.setItem(a.TOKEN_KEY,e.token),e.refresh_token&&localStorage.setItem(a.REFRESH_TOKEN_KEY,e.refresh_token),e.user&&localStorage.setItem(a.USER_KEY,JSON.stringify(e.user)),l(c(e)),e}return l(n(u(d))),i(u(d))}})),d=e("auth/register",(async(e,{dispatch:r,rejectWithValue:o})=>{try{const o=await t.register(e);return o.data.token?localStorage.setItem(a.TOKEN_KEY,o.data.token):o.data.access_token&&localStorage.setItem(a.TOKEN_KEY,o.data.access_token),o.data.refresh_token&&localStorage.setItem(a.REFRESH_TOKEN_KEY,o.data.refresh_token),o.data.user&&localStorage.setItem(a.USER_KEY,JSON.stringify(o.data.user)),r(c(o.data)),o.data}catch(s){return o(u(s))}})),E=e("auth/demoLogin",(async(e,{dispatch:t,rejectWithValue:r})=>{try{t(s());const e={id:`demo-${Math.floor(1e4*Math.random())}`,username:"demo_user",email:"demo@example.com",firstName:"Demo",lastName:"User",role:"user",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},r=`demo-token-${Date.now()}`,o=`demo-refresh-${Date.now()}`;localStorage.setItem(a.TOKEN_KEY,r),localStorage.setItem(a.REFRESH_TOKEN_KEY,o),localStorage.setItem(a.USER_KEY,JSON.stringify(e));const n={user:e,token:r,refresh_token:o};return t(c(n)),window.dispatchEvent(new Event("storage")),n}catch(o){return t(n(u(o))),r(u(o))}}));e("auth/registerUser",(async(e,{dispatch:r,rejectWithValue:o})=>{try{r(s());const o=await t.register(e);return o.data.token?localStorage.setItem(a.TOKEN_KEY,o.data.token):o.data.access_token&&localStorage.setItem(a.TOKEN_KEY,o.data.access_token),o.data.refresh_token&&localStorage.setItem(a.REFRESH_TOKEN_KEY,o.data.refresh_token),o.data.user&&localStorage.setItem(a.USER_KEY,JSON.stringify(o.data.user)),r(c(o.data.user||{})),o}catch(l){const e=u(l);return r(n(e.message)),o(e)}})),e("auth/updateUserProfile",(async(e,{dispatch:a,rejectWithValue:r})=>{try{const r=await t.updateUserProfile(e);return a(l(r)),r}catch(o){return r(u(o))}})),e("auth/loginUser",(async(e,{dispatch:r,rejectWithValue:o})=>{try{r(s());const o=await t.login(e);return o.data.token?localStorage.setItem(a.TOKEN_KEY,o.data.token):o.data.access_token&&localStorage.setItem(a.TOKEN_KEY,o.data.access_token),o.data.refresh_token&&localStorage.setItem(a.REFRESH_TOKEN_KEY,o.data.refresh_token),o.data.user&&localStorage.setItem(a.USER_KEY,JSON.stringify(o.data.user)),r(c(o.data.user||{})),o}catch(l){const e=u(l);return r(n(e.message)),o(e)}}));const m=e("auth/logout",(async(e,{dispatch:r,rejectWithValue:o})=>{try{if(!localStorage.getItem(a.TOKEN_KEY))return localStorage.removeItem(a.TOKEN_KEY),localStorage.removeItem(a.USER_KEY),window.location.href="/",{message:"Logged out successfully"};await t.logout();return localStorage.removeItem(a.TOKEN_KEY),localStorage.removeItem(a.USER_KEY),r(n({message:"Logged out successfully"})),window.location.href="/",{message:"Logged out successfully"}}catch(s){return localStorage.removeItem(a.TOKEN_KEY),localStorage.removeItem(a.USER_KEY),window.location.href="/",o(u(s))}}));export{i as a,E as d,m as l,d as r};
