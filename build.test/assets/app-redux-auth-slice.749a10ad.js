import{_ as e}from"./app-core.4fc76094.js";import{c as r,a as t}from"./vendor-redux-toolkit.fa18e013.js";import a from"./app-services-api.399edcf9.js";import{A as o,i as s,F as l,B as n,R as i,l as d}from"./app-utils.cd93f9c5.js";import{a as u,r as c}from"./app-redux-auth-thunks.3612091e.js";const g=(e,r={})=>{try{d("auth",`Auth operation: ${e}`,r)}catch(t){}},m=()=>{const e={id:"demo-"+Math.random().toString(36).substring(2,10),username:"demo_user",email:"demo@harmonic-universe.com",firstName:"Demo",lastName:"User",role:"user",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},r="demo-token-"+Math.random().toString(36).substring(2,15);return localStorage.setItem(o.TOKEN_KEY,r),localStorage.setItem(o.USER_KEY,JSON.stringify(e)),localStorage.setItem(o.REFRESH_TOKEN_KEY,"demo-refresh-"+Math.random().toString(36).substring(2,15)),{user:e,token:r}};r("auth/handleTokens",(async(e,{dispatch:r})=>{try{return e.token?localStorage.setItem(o.TOKEN_KEY,e.token):e.access_token&&localStorage.setItem(o.TOKEN_KEY,e.access_token),e.refresh_token&&localStorage.setItem(o.REFRESH_TOKEN_KEY,e.refresh_token),e.user&&localStorage.setItem(o.USER_KEY,JSON.stringify(e.user)),r(_(e)),e}catch(t){return r(y(t.message)),null}}));const E=r("auth/checkState",(async(e,{dispatch:r,getState:t})=>{try{const{auth:e}=t();if(e.isAuthenticated&&e.user)return e.user;const l=localStorage.getItem(o.TOKEN_KEY),n=(localStorage.getItem(o.REFRESH_TOKEN_KEY),localStorage.getItem(o.USER_KEY));if(!l)return r(h()),null;let i=null;if(n)try{i=JSON.parse(n)}catch(s){}try{const e=await a.validateToken();e.data&&e.data.user&&(i=e.data.user,localStorage.setItem(o.USER_KEY,JSON.stringify(i)))}catch(s){if(l.startsWith("demo-")){const e=(null==i?void 0:i.id)||`demo-${Date.now()}`;i={id:e,username:"demo_user",email:"demo@harmonic-universe.com",firstName:"Demo",lastName:"User",role:"user",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};const r=`demo-${e}-${Date.now()}`,t=`demo-refresh-${e}-${Date.now()}`;localStorage.setItem(o.TOKEN_KEY,r),localStorage.setItem(o.REFRESH_TOKEN_KEY,t),localStorage.setItem(o.USER_KEY,JSON.stringify(i))}else if(!i)return null}return i?(r(_({user:i,token:l})),i):null}catch(l){return r(h()),null}})),h=r("auth/logout",(async(e,{dispatch:r})=>{try{if(s())return null;const e=localStorage.getItem(o.TOKEN_KEY);return e&&e.startsWith("demo-"),localStorage.removeItem(o.TOKEN_KEY),localStorage.removeItem(o.REFRESH_TOKEN_KEY),localStorage.removeItem(o.USER_KEY),r(K()),null}catch(t){return r(I(t.message)),null}})),S=r("auth/demoLogin",(async(r,{dispatch:t,rejectWithValue:a})=>{var s,l;try{g("Demo login attempt");const r=await e((()=>import("./app-services-api.399edcf9.js")),["assets/app-services-api.399edcf9.js","assets/vendor-tone-lib.58935e90.js","assets/vendor-tone-util.a79eb63f.js","assets/vendor-tone-helpers.07e4d08d.js","assets/vendor-tone-platform.4f06f964.js","assets/vendor-tone-browser.dd42b0e8.js","assets/vendor-tone-classes.909fbaba.js","assets/vendor-tone-core-base.398f9a2a.js","assets/vendor-tone-defaults.617853c7.js","assets/vendor-tone-cancel.b93f499f.js","assets/vendor-tone-adapters.ec1cb8a7.js","assets/vendor-tone-lodash.1d9c6a83.js","assets/vendor-mui-core.4359195f.js","assets/vendor-tone-useThemeProps.a5833127.js","assets/vendor-tone-esm.8edb30e2.js","assets/vendor-tone-type.9e20d569.js","assets/vendor-react-core.73efc664.js","assets/vendor-tone-classnames.ea5eadd4.js","assets/vendor-tone-dist.6485732f.js","assets/vendor-tone-module.5bbe5778.js","assets/vendor-emotion-core.fcf170e6.js","assets/vendor-tone-src.89c6b4f5.js","assets/vendor-react-dom.e7130502.js","assets/vendor-react-scheduler.c51d43b5.js","assets/vendor-tone-styled-engine.72d9b7d5.js","assets/vendor-emotion-styled.ae0fdb08.js","assets/vendor-tone-StyledEngineProvider.626b917c.js","assets/vendor-tone-GlobalStyles.58bf1e29.js","assets/vendor-tone-createTheme.6c673f08.js","assets/vendor-tone-styleFunctionSx.dbcb4226.js","assets/vendor-tone-audio.70450c41.js","assets/vendor-tone-events.9afa7530.js","assets/vendor-tone-source.0b4b1ccd.js","assets/vendor-tone-tslib.f5f62bcb.js","assets/vendor-tone-signal.648ab60f.js","assets/vendor-tone-components.680c7d7e.js","assets/vendor-tone-hooks.ee856eec.js","assets/vendor-tone-es.9387ac1c.js","assets/vendor-tone-dist-web.442e5e08.js","assets/vendor-tone-Selector.7ca3b0ed.js","assets/vendor-tone-TimePanel.ca272323.js","assets/vendor-tone-panels.35d19878.js","assets/vendor-tone-DatetimePanel.eb5b0baf.js","assets/vendor-tone-DatePanel.9f66ebd0.js","assets/vendor-tone-WeekPanel.896778be.js","assets/vendor-tone-MonthPanel.70b7688e.js","assets/vendor-tone-QuarterPanel.144363f0.js","assets/vendor-tone-YearPanel.b92617d1.js","assets/vendor-tone-DecadePanel.8c0dc02f.js","assets/vendor-tone-TabPanelList.10481429.js","assets/vendor-tone-TabNavList.2513addc.js","assets/vendor-tone-Dialog.2ffc21c8.js","assets/vendor-tone-Content.9808c346.js","assets/vendor-tone-context.2287e470.js","assets/vendor-tone-SubMenu.1b0c3984.js","assets/vendor-tone-Popup.9ff27a32.js","assets/vendor-tone-SingleObserver.ddf11abe.js","assets/vendor-tone-icons.388eb8da.js","assets/vendor-tone-asn.f94d41fd.js","assets/vendor-tone-message.06244fbe.js","assets/vendor-tone-config-provider.2fc53c46.js","assets/vendor-tone-form.6dd4e248.js","assets/vendor-tone-grid.9235ce83.js","assets/vendor-tone-locale-provider.8d53e5b8.js","assets/vendor-tone-modal.4772d80b.js","assets/vendor-tone-button.429dcaea.js","assets/vendor-tone-space.95ee87ca.js","assets/vendor-tone-locale.9bc1cdd3.js","assets/vendor-tone-useModal.b905cda5.js","assets/vendor-tone-tooltip.4e7d946d.js","assets/vendor-tone-FormItem.7dbdfc6f.js","assets/vendor-tone-notification.2961f1bd.js","assets/vendor-tone-empty.6f888680.js","assets/vendor-tone-channel.a150b5c9.js","assets/vendor-tone-menu.86d2dba0.js","assets/vendor-tone-layout.4cbd4c32.js","assets/vendor-tone-useMediaQuery.95247262.js","assets/vendor-mui-buttons.74e6c144.js","assets/vendor-tone-system.c96386b3.js","assets/vendor-mui-inputs.b77362ac.js","assets/vendor-tone-validation.226ee14c.js","assets/vendor-tone-LocalizationProvider.b505657c.js","assets/vendor-tone-locales.e8ab67da.js","assets/vendor-tone-RtlProvider.df0b182e.js","assets/vendor-tone-constants.d67dcaf6.js","assets/vendor-mui-dialogs.59185291.js","assets/vendor-tone-instruments.3eb491c0.js","assets/vendor-tone-effects.66f8dc4e.js","assets/vendor-mui-list.1c6188a6.js","assets/vendor-tone-Stack.f8b60d0c.js","assets/vendor-mui-menus.328affd2.js","assets/vendor-tone-DefaultPropsProvider.3d25d93b.js","assets/vendor-tone-env.26551821.js","assets/vendor-react-props.65efe0a6.js","assets/app-utils.cd93f9c5.js","assets/app-core.4fc76094.js","assets/vendor-react-router.6468192e.js","assets/vendor-react-redux.ca23f922.js","assets/vendor-tone-shim.e999ecad.js","assets/vendor-tone-cjs.5d603e0b.js","assets/vendor-tone-use-sync-external-store-shim.d3746bbc.js","assets/app-redux-core.93965072.js","assets/vendor-redux-toolkit.fa18e013.js","assets/vendor-redux-core.f9606c35.js","assets/vendor-redux-persist.1ece7284.js","assets/app-redux-physics-slice.b0d37703.js","assets/app-redux-physics-thunks.c58b7b1a.js","assets/app-redux-scene-slice.81f21730.js","assets/app-redux-scene-thunks.d96f7130.js","assets/app-redux-character-slice.77cb9e4b.js","assets/app-redux-character-thunks.c46623e8.js","assets/app-redux-note-slice.2ed79aa2.js","assets/app-redux-note-thunks.e47bcfeb.js","assets/app-redux-other-slices.a7022ed8.js","assets/app-other-components.5e297c7e.js","assets/app-modals.11788519.js","assets/app-contexts.6347d155.js","styles/app-modals.8b853758.css","assets/app-constants.4a812be2.js","assets/app-redux-auth-thunks.3612091e.js","assets/vendor-mui-card.3348f8fd.js","assets/vendor-mui-layout.b03fb29f.js","assets/vendor-tone-Container.5ed3ed7d.js","assets/vendor-mui-icons-other.bc15c9b6.js","assets/app-characters-components.a508a592.js","assets/vendor-tone-select.c6c7620f.js","assets/vendor-tone-spin.d13f75fd.js","assets/vendor-tone-avatar.122bfb6a.js","assets/vendor-tone-popover.9c9808a5.js","styles/app-characters-components.c11b9da2.css","assets/vendor-tone-upload.27f9a3b5.js","assets/vendor-tone-UploadList.9372bedd.js","assets/vendor-tone-progress.cc741b51.js","assets/vendor-tone-card.8385b307.js","assets/vendor-tone-skeleton.45affeec.js","assets/vendor-tone-tabs.69cd71fe.js","assets/vendor-tone-switch.4218e0a6.js","assets/app-scenes-components.e3ba29e5.js","assets/app-scenes-form.07f7a30a.js","assets/vendor-tone-dayjs.54e2289e.js","assets/vendor-tone-alert.89362924.js","assets/vendor-tone-input.876080ec.js","assets/vendor-tone-divider.a6c32c3c.js","assets/vendor-tone-date-picker.3f71bbe3.js","assets/vendor-tone-tag.30f4ea2f.js","assets/vendor-tone-generate.3bd3dbc2.js","assets/vendor-tone-generatePicker.e957b148.js","assets/vendor-tone-radio.0de19148.js","assets/vendor-tone-typography.2404bb54.js","assets/vendor-tone-Base.81f829aa.js","assets/vendor-tone-copy-to-clipboard.e7f533f2.js","assets/vendor-tone-toggle-selection.c563a038.js","assets/app-services-other.47edd63d.js","assets/app-physics-components.dcafff4c.js","assets/app-physics-list.9dc0d346.js","assets/app-routes.fd68d670.js","assets/vendor-tone-DatePicker.de25fe8c.js","assets/vendor-tone-DesktopDatePicker.f7be1484.js","assets/vendor-tone-dateViewRenderers.da97565f.js","assets/vendor-tone-DateCalendar.07d8b1f1.js","assets/vendor-tone-PickersDay.36f5e5b8.js","assets/vendor-tone-PickersCalendarHeader.d19a4873.js","assets/vendor-tone-YearCalendar.53b1f79c.js","assets/vendor-tone-MonthCalendar.110ab177.js","assets/vendor-tone-DateField.a7ba308d.js","assets/vendor-tone-useField.40869926.js","assets/vendor-tone-PickersTextField.1b1b2159.js","assets/vendor-tone-PickersInput.177ec5f5.js","assets/vendor-tone-PickersInputBase.b4cbf25e.js","assets/vendor-tone-PickersSectionList.b3696c3f.js","assets/vendor-tone-PickersFilledInput.ea55e758.js","assets/vendor-tone-PickersOutlinedInput.cd7d73be.js","assets/vendor-tone-useDesktopPicker.83b3e221.js","assets/vendor-tone-usePicker.425377a1.js","assets/vendor-tone-PickersLayout.80c91798.js","assets/vendor-tone-PickersActionBar.6bdc4ff9.js","assets/vendor-tone-PickersShortcuts.51e2ec2a.js","assets/vendor-tone-MobileDatePicker.51f93f0c.js","assets/vendor-tone-useMobilePicker.b0b52352.js","assets/vendor-tone-input-number.28372503.js","styles/app-physics-components.5a8010c9.css","styles/app-other-components.e0155f62.css","styles/app-core.acfe6399.css"]).then((e=>e.default));if("function"==typeof r.createOrRefreshDemoUser){const e=r.createOrRefreshDemoUser();return g("API-based demo login successful",{userId:e.user.id}),t(_({user:e.user,token:e.token,refresh_token:e.refreshToken})),e}{const e={id:`demo-${Math.floor(1e4*Math.random())}`,username:"demo_user",email:"demo@example.com",firstName:"Demo",lastName:"User",role:"user",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()},r=`demo-token-${Date.now()}`,a=`demo-refresh-${Date.now()}`;return localStorage.setItem(o.TOKEN_KEY,r),localStorage.setItem(o.REFRESH_TOKEN_KEY,a),localStorage.setItem(o.USER_KEY,JSON.stringify(e)),g("Direct demo login successful",{userId:e.id}),t(_({user:e,token:r,refresh_token:a})),{user:e,token:r,refresh_token:a}}}catch(n){return((e,r)=>{try{d("auth",`Auth error in ${e}`,{error:r.message})}catch(t){}})("Demo login",n),a((null==(l=null==(s=n.response)?void 0:s.data)?void 0:l.message)||"Failed to demo login")}})),f=t({name:"auth",initialState:(()=>{try{if(l&&n){const e=m();return{user:e.user,token:e.token,isAuthenticated:!0,status:"idle",error:null,isLoading:!1,loginRedirect:i.HOME}}const e=localStorage.getItem(o.TOKEN_KEY),r=localStorage.getItem(o.USER_KEY),t=r?JSON.parse(r):null;if(n&&e&&e.startsWith("demo-")){const e=m();return{user:e.user,token:e.token,isAuthenticated:!0,status:"idle",error:null,isLoading:!1,loginRedirect:i.HOME}}return{user:t,token:e||null,isAuthenticated:!!e&&!!t,status:"idle",error:null,isLoading:!1,loginRedirect:i.HOME}}catch(e){return{user:null,token:null,isAuthenticated:!1,status:"idle",error:null,isLoading:!1,loginRedirect:i.HOME}}})(),reducers:{loginStart:e=>{e.isLoading=!0,e.error=null},loginSuccess:(e,r)=>{var t,a,o,s;e.isLoading=!1,e.error=null,e.authError=!1,(null==(t=r.payload)?void 0:t.user)?e.user=r.payload.user:((null==(a=r.payload)?void 0:a.name)||(null==(o=r.payload)?void 0:o.email)||(null==(s=r.payload)?void 0:s.id)||"object"==typeof r.payload)&&(e.user=r.payload),e.user,e.isAuthenticated=!0},loginFailure:(e,r)=>{var t;e.isLoading=!1,e.error=(null==(t=r.payload)?void 0:t.message)||r.payload||"Login failed",e.authError=!0,e.isAuthenticated=!1},logoutSuccess:e=>{e.user=null,e.isLoading=!1,e.error=null,e.authError=!1,e.isAuthenticated=!1,localStorage.removeItem(o.TOKEN_KEY),localStorage.removeItem(o.REFRESH_TOKEN_KEY),localStorage.removeItem(o.USER_KEY)},logoutFailure:(e,r)=>{e.isLoading=!1,e.error=r.payload},updateUser:(e,r)=>{e.user=r.payload},clearError:e=>{e.error=null},setNetworkError:(e,r)=>{e.networkError=r.payload},setOfflineMode:(e,r)=>{e.offlineMode=r.payload}},extraReducers:e=>{e.addCase(E.pending,(e=>{e.isLoading=!0,e.error=null,e.isAuthenticated=!1,g("check-auth-state-pending")})).addCase(E.fulfilled,((e,r)=>{e.isLoading=!1,r.payload?(e.user=r.payload,e.isAuthenticated=!0,e.error=null,g("check-auth-state-fulfilled",{userId:r.payload.id})):(e.user=null,e.isAuthenticated=!1,e.error="Authentication check failed",g("check-auth-state-fulfilled-no-user"))})).addCase(E.rejected,((e,r)=>{e.isLoading=!1,e.user=null,e.isAuthenticated=!1,e.error=r.payload,g("check-auth-state-rejected",{error:e.error})})).addCase(u.pending,(e=>{e.isLoading=!0,e.error=null,g("login-pending")})).addCase(u.fulfilled,((e,r)=>{var t;e.isLoading=!1;const a=r.payload||{};e.user=a.user||a,e.isAuthenticated=!0,e.error=null,g("login-fulfilled",{userId:null==(t=e.user)?void 0:t.id})})).addCase(u.rejected,((e,r)=>{e.isLoading=!1,e.error=r.payload,g("login-rejected",{error:e.error})})).addCase(c.pending,(e=>{e.isLoading=!0,e.error=null,g("register-pending")})).addCase(c.fulfilled,((e,r)=>{var t;e.isLoading=!1,e.user=r.payload,e.isAuthenticated=!0,e.error=null,g("register-fulfilled",{userId:null==(t=r.payload)?void 0:t.id})})).addCase(c.rejected,((e,r)=>{e.isLoading=!1,e.error=r.payload,g("register-rejected",{error:e.error})})).addCase(h.pending,(e=>{e.isLoading=!0,e.error=null,g("logout-pending")})).addCase(h.fulfilled,(e=>{e.isLoading=!1,e.user=null,e.isAuthenticated=!1,e.error=null,g("logout-fulfilled")})).addCase(h.rejected,((e,r)=>{e.isLoading=!1,e.error=r.payload,g("logout-rejected",{error:e.error})})).addCase(S.pending,(e=>{e.isLoading=!0,e.error=null,g("demo-login-pending")})).addCase(S.fulfilled,((e,r)=>{var t;e.isLoading=!1;const a=r.payload||{};e.user=a.user||a,e.isAuthenticated=!0,e.error=null,g("demo-login-fulfilled",{userId:null==(t=e.user)?void 0:t.id})})).addCase(S.rejected,((e,r)=>{e.isLoading=!1,e.error=r.payload,g("demo-login-rejected",{error:e.error})}))}}),{loginStart:p,loginSuccess:_,loginFailure:y,logoutSuccess:K,logoutFailure:I,updateUser:O,clearError:k,setNetworkError:N,setOfflineMode:R}=f.actions,v=f.reducer;export{p as a,y as b,E as c,S as d,_ as e,v as f,h as l,O as u};
