import{_ as e,a}from"./vendor-tone-esm.8edb30e2.js";import{r as o}from"./vendor-react-core.73efc664.js";import{c as t,b as n,ar as r,aq as l,g as s,as as i}from"./vendor-tone-hooks.ee856eec.js";import{u}from"./vendor-tone-validation.226ee14c.js";import{d as c,dr as d,q as p}from"./vendor-tone-util.a79eb63f.js";import{u as V}from"./vendor-tone-RtlProvider.df0b182e.js";const m=["className","sx"];const v=({props:v,valueManager:w,valueType:h,wrapperVariant:f,additionalViewProps:C,validator:F,autoFocusView:P,rendererInterceptor:S,fieldRef:g})=>{const y=(({props:a,valueManager:s,valueType:i,wrapperVariant:d,validator:p})=>{const{onAccept:V,onChange:m,value:v,defaultValue:w,closeOnSelect:h="desktop"===d,timezone:f,referenceDate:C}=a,{current:F}=o.useRef(w),{current:P}=o.useRef(void 0!==v),[S,g]=o.useState(f),y=t(),M=n(),{isOpen:k,setIsOpen:I}=r(a),{timezone:A,value:b,handleValueChange:O}=l({timezone:f,value:v,defaultValue:F,referenceDate:C,onChange:m,valueManager:s}),[R,U]=o.useState((()=>{let e;return e=void 0!==b?b:void 0!==F?F:s.emptyValue,{draft:e,lastPublishedValue:e,lastCommittedValue:e,lastControlledValue:v,hasBeenModifiedSinceMount:!1}})),T=s.getTimezone(y,R.draft);S!==f&&(g(f),f&&T&&f!==T&&U((a=>e({},a,{draft:s.setTimezone(y,f,a.draft)}))));const{getValidationErrorForNewValue:z}=u({props:a,validator:p,timezone:A,value:R.draft,onError:a.onError}),x=c((a=>{const o={action:a,dateState:R,hasChanged:e=>!s.areValuesEqual(y,a.value,e),isControlled:P,closeOnSelect:h},t=(e=>{const{action:a,hasChanged:o,dateState:t,isControlled:n}=e,r=!n&&!t.hasBeenModifiedSinceMount;return"setValueFromField"===a.name||("setValueFromAction"===a.name?!(!r||!["accept","today","clear"].includes(a.pickerAction))||o(t.lastPublishedValue):("setValueFromView"===a.name&&"shallow"!==a.selectionState||"setValueFromShortcut"===a.name)&&(!!r||o(t.lastPublishedValue)))})(o),n=(e=>{const{action:a,hasChanged:o,dateState:t,isControlled:n,closeOnSelect:r}=e,l=!n&&!t.hasBeenModifiedSinceMount;return"setValueFromAction"===a.name?!(!l||!["accept","today","clear"].includes(a.pickerAction))||o(t.lastCommittedValue):"setValueFromView"===a.name&&"finish"===a.selectionState&&r?!!l||o(t.lastCommittedValue):"setValueFromShortcut"===a.name&&"accept"===a.changeImportance&&o(t.lastCommittedValue)})(o),r=(e=>{const{action:a,closeOnSelect:o}=e;return"setValueFromAction"===a.name||("setValueFromView"===a.name?"finish"===a.selectionState&&o:"setValueFromShortcut"===a.name&&"accept"===a.changeImportance)})(o);U((o=>e({},o,{draft:a.value,lastPublishedValue:t?a.value:o.lastPublishedValue,lastCommittedValue:n?a.value:o.lastCommittedValue,hasBeenModifiedSinceMount:!0})));let l=null;const i=()=>{if(!l){const e="setValueFromField"===a.name?a.context.validationError:z(a.value);l={validationError:e},"setValueFromShortcut"===a.name&&(l.shortcut=a.shortcut)}return l};t&&O(a.value,i()),n&&V&&V(a.value,i()),r&&I(!1)}));if(R.lastControlledValue!==v){const a=s.areValuesEqual(y,R.draft,b);U((o=>e({},o,{lastControlledValue:v},a?{}:{lastCommittedValue:b,lastPublishedValue:b,draft:b,hasBeenModifiedSinceMount:!0})))}const E=c((()=>{x({value:s.emptyValue,name:"setValueFromAction",pickerAction:"clear"})})),j=c((()=>{x({value:R.lastPublishedValue,name:"setValueFromAction",pickerAction:"accept"})})),B=c((()=>{x({value:R.lastPublishedValue,name:"setValueFromAction",pickerAction:"dismiss"})})),D=c((()=>{x({value:R.lastCommittedValue,name:"setValueFromAction",pickerAction:"cancel"})})),q=c((()=>{x({value:s.getTodayValue(y,A,i),name:"setValueFromAction",pickerAction:"today"})})),L=c((e=>{e.preventDefault(),I(!0)})),N=c((e=>{null==e||e.preventDefault(),I(!1)})),G=c(((e,a="partial")=>x({name:"setValueFromView",value:e,selectionState:a}))),_=c(((e,a,o)=>x({name:"setValueFromShortcut",value:e,changeImportance:a,shortcut:o}))),H=c(((e,a)=>x({name:"setValueFromField",value:e,context:a}))),J={onClear:E,onAccept:j,onDismiss:B,onCancel:D,onSetToday:q,onOpen:L,onClose:N},K={value:R.draft,onChange:H},Q=o.useMemo((()=>s.cleanValue(y,R.draft)),[y,s,R.draft]),W={value:Q,onChange:G,onClose:N,open:k},X=e({},J,{value:Q,onChange:G,onSelectShortcut:_,isValid:e=>{const o=p({adapter:M,value:e,timezone:A,props:a});return!s.hasError(o)}}),Y=o.useMemo((()=>({onOpen:L,onClose:N,open:k})),[k,N,L]);return{open:k,fieldProps:K,viewProps:W,layoutProps:X,actions:J,contextValue:Y}})({props:v,valueManager:w,valueType:h,wrapperVariant:f,validator:F}),M=(({props:t,propsFromPickerValue:n,additionalViewProps:r,autoFocusView:l,rendererInterceptor:i,fieldRef:u})=>{const{onChange:V,open:v,onClose:w}=n,{view:h,views:f,openTo:C,onViewChange:F,viewRenderers:P,timezone:S}=t,g=a(t,m),{view:y,setView:M,defaultView:k,focusedView:I,setFocusedView:A,setValueAndGoToNextView:b}=s({view:h,views:f,openTo:C,onChange:V,onViewChange:F,autoFocus:l}),{hasUIView:O,viewModeLookup:R}=o.useMemo((()=>f.reduce(((e,a)=>{let o;return o=null!=P[a]?"UI":"field",e.viewModeLookup[a]=o,"UI"===o&&(e.hasUIView=!0),e}),{hasUIView:!1,viewModeLookup:{}})),[P,f]),U=o.useMemo((()=>f.reduce(((e,a)=>null!=P[a]&&d(a)?e+1:e),0)),[P,f]),T=R[y],z=c((()=>"UI"===T)),[x,E]=o.useState("UI"===T?y:null);return x!==y&&"UI"===R[y]&&E(y),p((()=>{"field"===T&&v&&(w(),setTimeout((()=>{var e,a;null==(e=null==u?void 0:u.current)||e.setSelectedSections(y),null==(a=null==u?void 0:u.current)||a.focusField(y)})))}),[y]),p((()=>{if(!v)return;let e=y;"field"===T&&null!=x&&(e=x),e!==k&&"UI"===R[e]&&"UI"===R[k]&&(e=k),e!==y&&M(e),A(e,!0)}),[v]),{hasUIView:O,shouldRestoreFocus:z,layoutProps:{views:f,view:x,onViewChange:M},renderCurrentView:()=>{if(null==x)return null;const a=P[x];if(null==a)return null;const o=e({},g,r,n,{views:f,timezone:S,onChange:b,view:x,onViewChange:M,focusedView:I,onFocusedViewChange:A,showViewSwitcher:U>1,timeViewsCount:U});return i?i(P,x,o):a(o)}}})({props:v,additionalViewProps:C,autoFocusView:P,fieldRef:g,propsFromPickerValue:y.viewProps,rendererInterceptor:S}),k=(({props:a,propsFromPickerValue:o,propsFromPickerViews:t,wrapperVariant:n})=>{const{orientation:r}=a,l=i(t.views,r),s=V();return{layoutProps:e({},t,o,{isLandscape:l,isRtl:s,wrapperVariant:n,disabled:a.disabled,readOnly:a.readOnly})}})({props:v,wrapperVariant:f,propsFromPickerValue:y.layoutProps,propsFromPickerViews:M.layoutProps}),I=function(e){const{props:a,pickerValueResponse:t}=e;return o.useMemo((()=>({value:t.viewProps.value,open:t.open,disabled:a.disabled??!1,readOnly:a.readOnly??!1})),[t.viewProps.value,t.open,a.disabled,a.readOnly])}({props:v,pickerValueResponse:y});return{open:y.open,actions:y.actions,fieldProps:y.fieldProps,renderCurrentView:M.renderCurrentView,hasUIView:M.hasUIView,shouldRestoreFocus:M.shouldRestoreFocus,layoutProps:k.layoutProps,contextValue:y.contextValue,ownerState:I}};export{v as u};
