import{aP as e}from"./vendor-tone-util.a79eb63f.js";import{r as t,p as n,a as o,c as s,b as r,d as a,t as i,h as u}from"./vendor-tone-helpers.07e4d08d.js";import{A as d,a as l,b as c}from"./vendor-tone-core-base.398f9a2a.js";import{t as p}from"./vendor-tone-defaults.617853c7.js";import{C as f}from"./vendor-tone-cancel.b93f499f.js";import{p as m}from"./vendor-tone-platform.4f06f964.js";const h="undefined"!=typeof XMLHttpRequest&&function(s){return new Promise((function(r,a){const i=t(s);let u=i.data;const h=d.from(i.headers).normalize();let y,w,b,g,R,{responseType:T,onUploadProgress:E,onDownloadProgress:v}=i;function O(){g&&g(),R&&R(),i.cancelToken&&i.cancelToken.unsubscribe(y),i.signal&&i.signal.removeEventListener("abort",y)}let x=new XMLHttpRequest;function S(){if(!x)return;const e=d.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders()),t={data:T&&"text"!==T&&"json"!==T?x.response:x.responseText,status:x.status,statusText:x.statusText,headers:e,config:s,request:x};c((function(e){r(e),O()}),(function(e){a(e),O()}),t),x=null}x.open(i.method.toUpperCase(),i.url,!0),x.timeout=i.timeout,"onloadend"in x?x.onloadend=S:x.onreadystatechange=function(){x&&4===x.readyState&&(0!==x.status||x.responseURL&&0===x.responseURL.indexOf("file:"))&&setTimeout(S)},x.onabort=function(){x&&(a(new l("Request aborted",l.ECONNABORTED,s,x)),x=null)},x.onerror=function(){a(new l("Network Error",l.ERR_NETWORK,s,x)),x=null},x.ontimeout=function(){let e=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const t=i.transitional||p;i.timeoutErrorMessage&&(e=i.timeoutErrorMessage),a(new l(e,t.clarifyTimeoutError?l.ETIMEDOUT:l.ECONNABORTED,s,x)),x=null},void 0===u&&h.setContentType(null),"setRequestHeader"in x&&e.forEach(h.toJSON(),(function(e,t){x.setRequestHeader(t,e)})),e.isUndefined(i.withCredentials)||(x.withCredentials=!!i.withCredentials),T&&"json"!==T&&(x.responseType=i.responseType),v&&([b,R]=n(v,!0),x.addEventListener("progress",b)),E&&x.upload&&([w,g]=n(E),x.upload.addEventListener("progress",w),x.upload.addEventListener("loadend",g)),(i.cancelToken||i.signal)&&(y=e=>{x&&(a(!e||e.type?new f(null,s,x):e),x.abort(),x=null)},i.cancelToken&&i.cancelToken.subscribe(y),i.signal&&(i.signal.aborted?y():i.signal.addEventListener("abort",y)));const P=o(i.url);P&&-1===m.protocols.indexOf(P)?a(new l("Unsupported protocol "+P+":",l.ERR_BAD_REQUEST,s)):x.send(u||null)}))},y="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,w=y&&"function"==typeof ReadableStream,b=y&&("function"==typeof TextEncoder?(g=new TextEncoder,e=>g.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var g;const R=(e,...t)=>{try{return!!e(...t)}catch(n){return!1}},T=w&&R((()=>{let e=!1;const t=new Request(m.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),E=w&&R((()=>e.isReadableStream(new Response("").body))),v={stream:E&&(e=>e.body)};var O;y&&(O=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((t=>{!v[t]&&(v[t]=e.isFunction(O[t])?e=>e[t]():(e,n)=>{throw new l(`Response type '${t}' is not supported`,l.ERR_NOT_SUPPORT,n)})})));const x=async(t,n)=>{const o=e.toFiniteNumber(t.getContentLength());return null==o?(async t=>{if(null==t)return 0;if(e.isBlob(t))return t.size;if(e.isSpecCompliantForm(t)){const e=new Request(m.origin,{method:"POST",body:t});return(await e.arrayBuffer()).byteLength}return e.isArrayBufferView(t)||e.isArrayBuffer(t)?t.byteLength:(e.isURLSearchParams(t)&&(t+=""),e.isString(t)?(await b(t)).byteLength:void 0)})(n):o},S={http:u,xhr:h,fetch:y&&(async o=>{let{url:u,method:p,data:f,signal:m,cancelToken:h,timeout:y,onDownloadProgress:w,onUploadProgress:b,responseType:g,headers:R,withCredentials:O="same-origin",fetchOptions:S}=t(o);g=g?(g+"").toLowerCase():"text";let P,C=s([m,h&&h.toAbortSignal()],y);const L=C&&C.unsubscribe&&(()=>{C.unsubscribe()});let q;try{if(b&&T&&"get"!==p&&"head"!==p&&0!==(q=await x(R,f))){let t,o=new Request(u,{method:"POST",body:f,duplex:"half"});if(e.isFormData(f)&&(t=o.headers.get("content-type"))&&R.setContentType(t),o.body){const[e,t]=r(q,n(a(b)));f=i(o.body,65536,e,t)}}e.isString(O)||(O=O?"include":"omit");const t="credentials"in Request.prototype;P=new Request(u,{...S,signal:C,method:p.toUpperCase(),headers:R.normalize().toJSON(),body:f,duplex:"half",credentials:t?O:void 0});let s=await fetch(P);const l=E&&("stream"===g||"response"===g);if(E&&(w||l&&L)){const t={};["status","statusText","headers"].forEach((e=>{t[e]=s[e]}));const o=e.toFiniteNumber(s.headers.get("content-length")),[u,d]=w&&r(o,n(a(w),!0))||[];s=new Response(i(s.body,65536,u,(()=>{d&&d(),L&&L()})),t)}g=g||"text";let m=await v[e.findKey(v,g)||"text"](s,o);return!l&&L&&L(),await new Promise(((e,t)=>{c(e,t,{data:m,headers:d.from(s.headers),status:s.status,statusText:s.statusText,config:o,request:P})}))}catch(N){if(L&&L(),N&&"TypeError"===N.name&&/fetch/i.test(N.message))throw Object.assign(new l("Network Error",l.ERR_NETWORK,o,P),{cause:N.cause||N});throw l.from(N,N&&N.code,o,P)}})};e.forEach(S,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(n){}Object.defineProperty(e,"adapterName",{value:t})}}));const P=e=>`- ${e}`,C=t=>e.isFunction(t)||null===t||!1===t,L={getAdapter:t=>{t=e.isArray(t)?t:[t];const{length:n}=t;let o,s;const r={};for(let e=0;e<n;e++){let n;if(o=t[e],s=o,!C(o)&&(s=S[(n=String(o)).toLowerCase()],void 0===s))throw new l(`Unknown adapter '${n}'`);if(s)break;r[n||"#"+e]=s}if(!s){const e=Object.entries(r).map((([e,t])=>`adapter ${e} `+(!1===t?"is not supported by the environment":"is not available in the build")));let t=n?e.length>1?"since :\n"+e.map(P).join("\n"):" "+P(e[0]):"as no adapter specified";throw new l("There is no suitable adapter to dispatch the request "+t,"ERR_NOT_SUPPORT")}return s},adapters:S};export{L as a};
